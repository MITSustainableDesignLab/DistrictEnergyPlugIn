<UserControl x:Class="DistrictEnergy.DistrictControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:districtEnergy="clr-namespace:DistrictEnergy"
             xmlns:vm="clr-namespace:DistrictEnergy.ViewModels"
             xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
             mc:Ignorable="d"
             d:DesignWidth="610" d:DesignHeight="1295" d:DataContext="{d:DesignData ResultsViewModel}">
    <UserControl.Resources>
        <Style x:Key="TextBoxInError" TargetType="{x:Type TextBox}">
            <Style.Triggers>
                <Trigger Property="Validation.HasError" Value="true">
                    <Setter Property="ToolTip"
                            Value="{Binding RelativeSource={x:Static RelativeSource.Self},
                              Path=(Validation.Errors)[0].ErrorContent}" />
                </Trigger>
            </Style.Triggers>
        </Style>
        <districtEnergy:InverseAndBooleansToBooleanConverter x:Key="ButtonEnabled" />
        <SolidColorBrush x:Key="TextBox.Static.Border" Color="#FFABAdB3" />
        <SolidColorBrush x:Key="TextBox.MouseOver.Border" Color="#FF7EB4EA" />
        <SolidColorBrush x:Key="TextBox.Focus.Border" Color="#FF569DE5" />
        <Style x:Key="TextBoxStyle" TargetType="{x:Type TextBox}">
            <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.WindowBrushKey}}" />
            <Setter Property="BorderBrush" Value="{StaticResource TextBox.Static.Border}" />
            <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="KeyboardNavigation.TabNavigation" Value="Cycle" />
            <Setter Property="HorizontalContentAlignment" Value="Left" />
            <Setter Property="FocusVisualStyle" Value="{x:Null}" />
            <Setter Property="ScrollViewer.PanningMode" Value="VerticalFirst" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
            <Setter Property="HorizontalAlignment" Value="Center" />
            <Setter Property="Width" Value="40" />
            <Setter Property="Height" Value="22" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type TextBox}">
                        <Border x:Name="border" BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                Background="{TemplateBinding Background}" SnapsToDevicePixels="True">
                            <ScrollViewer x:Name="PART_ContentHost" Focusable="false"
                                          HorizontalScrollBarVisibility="Hidden" VerticalScrollBarVisibility="Hidden" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsEnabled" Value="false">
                                <Setter Property="Opacity" TargetName="border" Value="0.56" />
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="true">
                                <Setter Property="BorderBrush" TargetName="border"
                                        Value="{StaticResource TextBox.MouseOver.Border}" />
                            </Trigger>
                            <Trigger Property="IsKeyboardFocused" Value="true">
                                <Setter Property="BorderBrush" TargetName="border"
                                        Value="{StaticResource TextBox.Focus.Border}" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <MultiTrigger>
                    <MultiTrigger.Conditions>
                        <Condition Property="IsInactiveSelectionHighlightEnabled" Value="true" />
                        <Condition Property="IsSelectionActive" Value="false" />
                    </MultiTrigger.Conditions>
                    <Setter Property="SelectionBrush"
                            Value="{DynamicResource {x:Static SystemColors.InactiveSelectionHighlightBrushKey}}" />
                </MultiTrigger>
            </Style.Triggers>

        </Style>
    </UserControl.Resources>
    <TabControl x:Name="TabControl" HorizontalAlignment="Stretch" Margin="0,0,0,0" VerticalAlignment="Top"
                RenderTransformOrigin="0.501,0.507">
        <TabItem Header="Thermal Plant" IsSelected="True">
            <TabItem.Resources>
                <Style x:Key="PlantSettingStyle" TargetType="{x:Type Label}">
                    <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}" />
                    <Setter Property="Background" Value="Transparent" />
                    <Setter Property="Padding" Value="5" />
                    <Setter Property="HorizontalContentAlignment" Value="Left" />
                    <Setter Property="VerticalContentAlignment" Value="Top" />
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="{x:Type Label}">
                                <Border BorderBrush="{TemplateBinding BorderBrush}"
                                        BorderThickness="{TemplateBinding BorderThickness}"
                                        Background="{TemplateBinding Background}" SnapsToDevicePixels="true">
                                    <ContentPresenter
                                        HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                        RecognizesAccessKey="True"
                                        SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"
                                        VerticalAlignment="{TemplateBinding VerticalContentAlignment}" />
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsEnabled" Value="false">
                                        <Setter Property="Foreground"
                                                Value="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" />
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                    <Setter Property="Height" Value="Auto" />
                    <Setter Property="Margin" Value="0,2" />
                    <Setter Property="FontWeight" Value="Normal" />
                    <Setter Property="HorizontalAlignment" Value="Left" />
                </Style>
                <Style x:Key="PlantComponentHeader" TargetType="{x:Type TextBlock}">
                    <Setter Property="TextWrapping" Value="NoWrap" />
                    <Setter Property="TextTrimming" Value="None" />
                    <Setter Property="Margin" Value="5, 5" />
                    <Setter Property="FontSize" Value="14" />
                    <Setter Property="Foreground" Value="#404040" />
                </Style>
            </TabItem.Resources>
            <Grid ScrollViewer.CanContentScroll="True">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>
                <Button Content="Run Simulation" Padding="5" Margin="5" Grid.Row="0" Click="RunSimulationClick">
                    <Button.IsEnabled>
                        <MultiBinding Converter="{StaticResource ButtonEnabled}" Mode="TwoWay">
                            <Binding ElementName="TurbineEff" Path="(Validation.HasError)" />
                            <Binding ElementName="AutHwt" Path="(Validation.HasError)" />
                            <Binding ElementName="AutBat" Path="(Validation.HasError)" />
                        </MultiBinding>
                    </Button.IsEnabled>
                </Button>
                <ScrollViewer Grid.Row="1">
                    <StackPanel VerticalAlignment="Top" Width="Auto">
                        <StackPanel.Resources>
                            <Style x:Key="StackPanelStyle" TargetType="StackPanel">
                                <Setter Property="HorizontalAlignment" Value="Stretch" />
                                <Setter Property="VerticalAlignment" Value="Top" />
                                <Setter Property="Width" Value="Auto" />
                                <Setter Property="Margin" Value="5,0,5,5" />
                            </Style>
                        </StackPanel.Resources>
                        <Grid x:Name="ChilledWaterGroup" Margin="10">
                            <Grid.Effect>
                                <DropShadowEffect BlurRadius="15" Direction="-90" RenderingBias="Quality"
                                                  Opacity=".3"
                                                  ShadowDepth="1" Color="DarkBlue" />
                            </Grid.Effect>

                            <Border CornerRadius="5" Background="White">
                                <StackPanel>
                                    <Grid x:Name="Abs">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <TextBlock Grid.Row="0" Style="{DynamicResource PlantComponentHeader}">Absorption Chiller</TextBlock>
                                        <StackPanel Grid.Row="1" HorizontalAlignment="Stretch" VerticalAlignment="Top"
                                                    Width="Auto"
                                                    Background="White" Margin="5,0,5,5">
                                            <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" MinWidth="30" />
                                                    <ColumnDefinition Width="Auto" MinWidth="35" />
                                                </Grid.ColumnDefinitions>
                                                <Label Content="Capacity as percent of peak cooling load"
                                                       Style="{DynamicResource PlantSettingStyle}" />
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox
                                                        Text="{Binding OFF_ABS, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                        Style="{DynamicResource TextBoxStyle}" />

                                                </StackPanel>
                                            </Grid>
                                            <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" MinWidth="30" />
                                                    <ColumnDefinition Width="Auto" MinWidth="35" />
                                                </Grid.ColumnDefinitions>
                                                <Label Content="Cooling coefficient of performance"
                                                       Style="{DynamicResource PlantSettingStyle}" />

                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <TextBox Style="{DynamicResource TextBoxStyle}"
                                                             Text="{Binding CCOP_ABS, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                </StackPanel>
                                            </Grid>
                                        </StackPanel>
                                    </Grid>
                                    <Grid x:Name="Ech" VerticalAlignment="Top"
                                          Height="Auto">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <TextBlock Grid.Row="0" Style="{DynamicResource PlantComponentHeader}">
                                            Electric Chiller
                                        </TextBlock>

                                        <StackPanel HorizontalAlignment="Stretch" VerticalAlignment="Top" Width="Auto"
                                                    Margin="5,0,5,5" Grid.Row="1">
                                            <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" MinWidth="30" />
                                                    <ColumnDefinition Width="Auto" MinWidth="35" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel HorizontalAlignment="Left">
                                                    <Label Content="Cooling coefficient of performance"
                                                           Style="{DynamicResource PlantSettingStyle}" />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <TextBox Style="{DynamicResource TextBoxStyle}"
                                                             Text="{Binding CCOP_ECH, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                </StackPanel>
                                            </Grid>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </Grid>
                        <Grid x:Name="HotWaterGroup" Margin="10">
                            <Grid.Effect>
                                <DropShadowEffect BlurRadius="15" Direction="-90" RenderingBias="Quality"
                                                  Opacity=".3"
                                                  ShadowDepth="1" Color="Crimson" />
                            </Grid.Effect>
                            <Border CornerRadius="5" Background="White">
                                <StackPanel>
                                    <Grid x:Name="Ehp" VerticalAlignment="Top" Height="Auto">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <TextBlock Grid.Row="0" Style="{DynamicResource PlantComponentHeader}">
                                            Electric Heat Pump
                                        </TextBlock>

                                        <StackPanel
                                            Grid.Row="1" Style="{StaticResource StackPanelStyle}">
                                            <Grid VerticalAlignment="Top">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" MinWidth="30" />
                                                    <ColumnDefinition Width="Auto" MinWidth="35" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel HorizontalAlignment="Left">
                                                    <Label Content="Capacity as percent of peak cooling load"
                                                           Style="{DynamicResource PlantSettingStyle}" />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox Style="{DynamicResource TextBoxStyle}"
                                                             Text="{Binding OFF_EHP, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                                                </StackPanel>
                                            </Grid>
                                            <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" MinWidth="30" />
                                                    <ColumnDefinition Width="Auto" MinWidth="35" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel HorizontalAlignment="Left">
                                                    <Label Content="Heating coefficient of performance"
                                                           Style="{DynamicResource PlantSettingStyle}" />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <TextBox Style="{DynamicResource TextBoxStyle}"
                                                             Text="{Binding HCOP_EHP, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                                                </StackPanel>
                                            </Grid>
                                        </StackPanel>
                                    </Grid>
                                    <Grid x:Name="Shw" VerticalAlignment="Top" Height="Auto">

                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <TextBlock Grid.Row="0" Style="{DynamicResource PlantComponentHeader}">Solar Hot Water</TextBlock>

                                        <StackPanel Grid.Row="1" Style="{StaticResource StackPanelStyle}">

                                            <Grid VerticalAlignment="Top">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" MinWidth="30" />
                                                    <ColumnDefinition Width="Auto" MinWidth="35" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel HorizontalAlignment="Left">
                                                    <Label Content="Target offset as percent of annual energy "
                                                           Style="{DynamicResource PlantSettingStyle}" />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox Style="{DynamicResource TextBoxStyle}"
                                                             Text="{Binding OFF_SHW, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                </StackPanel>
                                            </Grid>
                                            <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" MinWidth="30" />
                                                    <ColumnDefinition Width="Auto" MinWidth="35" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel HorizontalAlignment="Left">
                                                    <Label Content="Collector efficiency"
                                                           Style="{DynamicResource PlantSettingStyle}" />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox Style="{DynamicResource TextBoxStyle}"
                                                             Text="{Binding EFF_SHW, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                </StackPanel>
                                            </Grid>
                                            <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" MinWidth="30" />
                                                    <ColumnDefinition Width="Auto" MinWidth="35" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel HorizontalAlignment="Left">
                                                    <Label Content="Area utilization factor "
                                                           ToolTip="Accounts for collector frames and other infrastructural requirements"
                                                           Style="{DynamicResource PlantSettingStyle}" />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox Style="{DynamicResource TextBoxStyle}"
                                                             Text="{Binding UTIL_SHW, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                </StackPanel>
                                            </Grid>
                                            <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" MinWidth="30" />
                                                    <ColumnDefinition Width="Auto" MinWidth="35" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel HorizontalAlignment="Left">
                                                    <Label Content="Miscellaneous losses"
                                                           Style="{DynamicResource PlantSettingStyle}" />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox Style="{DynamicResource TextBoxStyle}"
                                                             Text="{Binding LOSS_SHW, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                </StackPanel>
                                            </Grid>

                                        </StackPanel>
                                    </Grid>
                                    <Grid x:Name="Hwt" VerticalAlignment="Top" Height="Auto">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <TextBlock Grid.Row="0" Style="{DynamicResource PlantComponentHeader}">Hot Water Tank</TextBlock>
                                        <StackPanel Style="{StaticResource StackPanelStyle}" Grid.Row="1">
                                            <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" MinWidth="30" />
                                                    <ColumnDefinition Width="Auto" MinWidth="35" />
                                                </Grid.ColumnDefinitions>

                                                <StackPanel HorizontalAlignment="Left">
                                                    <Label Content="Capacity as number of days of autonomy"
                                                           Style="{DynamicResource PlantSettingStyle}" />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <Label Content="n days" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox x:Name="AutHwt"
                                                             Style="{DynamicResource TextBoxStyle}">
                                                        <TextBox.Text>
                                                            <Binding Path="AUT_HWT" BindsDirectlyToSource="True"
                                                                     Mode="TwoWay"
                                                                     UpdateSourceTrigger="PropertyChanged">
                                                                <Binding.ValidationRules>
                                                                    <districtEnergy:DoubleRangeRule Min="0" Max="365" />
                                                                </Binding.ValidationRules>
                                                            </Binding>
                                                        </TextBox.Text>
                                                    </TextBox>

                                                </StackPanel>
                                            </Grid>
                                            <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" MinWidth="30" />
                                                    <ColumnDefinition Width="Auto" MinWidth="35" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel HorizontalAlignment="Left">
                                                    <Label Content="Miscellaneous losses"
                                                           Style="{DynamicResource PlantSettingStyle}" />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox Style="{DynamicResource TextBoxStyle}"
                                                             Text="{Binding LOSS_HWT, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                                                </StackPanel>
                                            </Grid>
                                            <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" MinWidth="30" />
                                                    <ColumnDefinition Width="Auto" MinWidth="35" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel HorizontalAlignment="Left">
                                                    <Label Content="Beginning Charged State"
                                                           Style="{DynamicResource PlantSettingStyle}" />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox Style="{DynamicResource TextBoxStyle}"
                                                             Text="{Binding TANK_START, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                                                </StackPanel>
                                            </Grid>


                                        </StackPanel>
                                    </Grid>
                                    <Grid x:Name="Ngb" VerticalAlignment="Top" Height="Auto">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <TextBlock Grid.Row="0" Style="{DynamicResource PlantComponentHeader}">Natural Gas Boiler</TextBlock>
                                        <StackPanel Style="{StaticResource StackPanelStyle}" Grid.Row="1">
                                            <Grid VerticalAlignment="Top">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" MinWidth="30" />
                                                    <ColumnDefinition Width="Auto" MinWidth="35" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel HorizontalAlignment="Left">
                                                    <Label Content="Heating efficiency"
                                                           Style="{DynamicResource PlantSettingStyle}" />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox Style="{DynamicResource TextBoxStyle}"
                                                             Text="{Binding EFF_NGB, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                                                </StackPanel>
                                            </Grid>
                                        </StackPanel>
                                    </Grid>

                                </StackPanel>

                            </Border>
                        </Grid>
                        <Grid x:Name="ElectricGenGroup" Margin="10">
                            <Grid.Effect>
                                <DropShadowEffect BlurRadius="15" Direction="-90" RenderingBias="Quality"
                                                  Opacity=".3"
                                                  ShadowDepth="1" Color="Orange" />
                            </Grid.Effect>
                            <Border CornerRadius="5" Background="White">
                                <StackPanel>
                                    <Grid x:Name="Pv" VerticalAlignment="Top" Height="Auto">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <TextBlock Grid.Row="0" Style="{DynamicResource PlantComponentHeader}">
                                            Photovoltaic Array
                                        </TextBlock>
                                        <StackPanel Style="{StaticResource StackPanelStyle}"
                                                    Grid.Row="1">
                                            <Grid VerticalAlignment="Top">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" MinWidth="30" />
                                                    <ColumnDefinition Width="Auto" MinWidth="35" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel HorizontalAlignment="Left">
                                                    <Label Content="Target offset as percent of annual energy"
                                                           Style="{DynamicResource PlantSettingStyle}" />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox Style="{DynamicResource TextBoxStyle}"
                                                             Text="{Binding OFF_PV, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                                                </StackPanel>
                                            </Grid>
                                            <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" MinWidth="30" />
                                                    <ColumnDefinition Width="Auto" MinWidth="35" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel HorizontalAlignment="Left">
                                                    <Label Content="Cell efficiency"
                                                           Style="{DynamicResource PlantSettingStyle}" />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox Style="{DynamicResource TextBoxStyle}"
                                                             Text="{Binding EFF_PV, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                                                </StackPanel>
                                            </Grid>
                                            <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" MinWidth="30" />
                                                    <ColumnDefinition Width="Auto" MinWidth="35" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel HorizontalAlignment="Left">
                                                    <Label Content="Area utilization factor"
                                                           Style="{DynamicResource PlantSettingStyle}" />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox Style="{DynamicResource TextBoxStyle}"
                                                             Text="{Binding UTIL_SHW, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                                                </StackPanel>
                                            </Grid>
                                            <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" MinWidth="30" />
                                                    <ColumnDefinition Width="Auto" MinWidth="35" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel HorizontalAlignment="Left">
                                                    <Label Content="Miscellaneous losses"
                                                           Style="{DynamicResource PlantSettingStyle}" />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox Style="{DynamicResource TextBoxStyle}"
                                                             Text="{Binding LOSS_PV, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                </StackPanel>
                                            </Grid>

                                        </StackPanel>
                                    </Grid>
                                    <Grid x:Name="Wnd" VerticalAlignment="Top" Height="Auto">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <TextBlock Grid.Row="0" Style="{DynamicResource PlantComponentHeader}">
                                            Wind Turbines
                                        </TextBlock>
                                        <StackPanel Style="{StaticResource StackPanelStyle}"
                                                    Grid.Row="1">
                                            <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="Auto" MinWidth="35" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel HorizontalAlignment="Left">
                                                    <Label Content="Target offset as percent of annual energy"

                                                           Style="{DynamicResource PlantSettingStyle}" />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox Style="{DynamicResource TextBoxStyle}"
                                                             Text="{Binding OFF_WND, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                                                </StackPanel>
                                            </Grid>
                                            <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="Auto" MinWidth="35" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel HorizontalAlignment="Left">
                                                    <Label Content="Turbine efficiency"
                                                           Style="{DynamicResource PlantSettingStyle}" />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox x:Name="TurbineEff" Margin="0,2" MaxLines="1"
                                                             Style="{StaticResource TextBoxInError}"
                                                             VerticalContentAlignment="Center"
                                                             HorizontalAlignment="Center"
                                                             Width="40"
                                                             AllowDrop="True"
                                                             ToolTip="{Binding ElementName=TurbineEff, Path=(Validation.Errors)[0].ErrorContent}"
                                                             Height="22">
                                                        <TextBox.Text>
                                                            <Binding Path="EFF_WND"
                                                                     UpdateSourceTrigger="PropertyChanged">
                                                                <Binding.ValidationRules>
                                                                    <districtEnergy:DoubleRangeRule Min="0" Max="59" />
                                                                </Binding.ValidationRules>
                                                            </Binding>
                                                        </TextBox.Text>
                                                    </TextBox>

                                                </StackPanel>
                                            </Grid>
                                            <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel HorizontalAlignment="Left">
                                                    <Label Content="Cut-in speed "
                                                           Style="{DynamicResource PlantSettingStyle}" />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <Label Content="m/s" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox Style="{DynamicResource TextBoxStyle}"
                                                             Text="{Binding CIN_WND, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                                                </StackPanel>
                                            </Grid>
                                            <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel HorizontalAlignment="Left">
                                                    <Label Content="Cut-out speed"
                                                           Style="{DynamicResource PlantSettingStyle}" />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <Label Content="m/s" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox Style="{DynamicResource TextBoxStyle}"
                                                             Text="{Binding COUT_WND, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                </StackPanel>
                                            </Grid>
                                            <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" MinWidth="30" />
                                                    <ColumnDefinition Width="Auto" MinWidth="35" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel HorizontalAlignment="Left">
                                                    <Label Content="Rotor area per turbine"
                                                           Style="{DynamicResource PlantSettingStyle}" />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <Label Content="m²" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox Style="{DynamicResource TextBoxStyle}"
                                                             Text="{Binding ROT_WND, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                </StackPanel>
                                            </Grid>
                                            <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="Auto" MinWidth="35" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel HorizontalAlignment="Left">
                                                    <Label Content="Miscellaneous losses"
                                                           Style="{DynamicResource PlantSettingStyle}" />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox Style="{DynamicResource TextBoxStyle}"
                                                             Text="{Binding LOSS_WND, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                </StackPanel>
                                            </Grid>


                                        </StackPanel>
                                    </Grid>
                                    <Grid x:Name="Bat" VerticalAlignment="Top" Height="Auto">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <TextBlock Grid.Row="0" Style="{DynamicResource PlantComponentHeader}">
                                            Battery Bank
                                        </TextBlock>
                                        <StackPanel Style="{StaticResource StackPanelStyle}"
                                                    Grid.Row="1">
                                            <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" MinWidth="50" />
                                                    <ColumnDefinition Width="Auto" MinWidth="35" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel HorizontalAlignment="Left">
                                                    <Label Content="Capacity as number of days of autonomy"

                                                           Style="{DynamicResource PlantSettingStyle}" />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <Label Content="n days" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox x:Name="AutBat"
                                                             Style="{DynamicResource TextBoxStyle}">
                                                        <TextBox.Text>
                                                            <Binding Path="AUT_BAT" BindsDirectlyToSource="True"
                                                                     Mode="TwoWay"
                                                                     UpdateSourceTrigger="PropertyChanged">
                                                                <Binding.ValidationRules>
                                                                    <districtEnergy:DoubleRangeRule Min="0" Max="365" />
                                                                </Binding.ValidationRules>
                                                            </Binding>
                                                        </TextBox.Text>
                                                    </TextBox>
                                                </StackPanel>
                                            </Grid>
                                            <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="Auto" MinWidth="35" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel HorizontalAlignment="Left">
                                                    <Label Content="Miscellaneous losses"
                                                           Style="{DynamicResource PlantSettingStyle}" />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox Style="{DynamicResource TextBoxStyle}"
                                                             Text="{Binding LOSS_BAT, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                </StackPanel>
                                            </Grid>
                                            <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" MinWidth="30" />
                                                    <ColumnDefinition Width="Auto" MinWidth="35" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel HorizontalAlignment="Left">
                                                    <Label Content="Starting Charge"
                                                           Style="{DynamicResource PlantSettingStyle}" />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox Style="{DynamicResource TextBoxStyle}"
                                                             Text="{Binding BAT_START, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                </StackPanel>
                                            </Grid>
                                        </StackPanel>
                                    </Grid>

                                </StackPanel>

                            </Border>
                        </Grid>
                        <Grid x:Name="ChpGroup" Margin="10">
                            <Grid.Effect>
                                <DropShadowEffect BlurRadius="15" Direction="-90" RenderingBias="Quality"
                                                  Opacity=".3"
                                                  ShadowDepth="1" Color="Black" />
                            </Grid.Effect>
                            <Border CornerRadius="5" Background="White">
                                <StackPanel>
                                    <Grid x:Name="Chp" VerticalAlignment="Top" Height="Auto">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <TextBlock Grid.Row="0" Style="{DynamicResource PlantComponentHeader}">
                                            Combined Heating &amp; Power
                                        </TextBlock>
                                        <StackPanel Style="{StaticResource StackPanelStyle}"
                                                    Grid.Row="1">
                                            <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" MinWidth="35" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel HorizontalAlignment="Left" Width="78">
                                                    <Label Content="Tracking mode"
                                                           Style="{DynamicResource PlantSettingStyle}" />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <ComboBox SelectedValue="{Binding TMOD_CHP}"
                                                              ItemsSource="{Binding PosibleTrackingModes}"
                                                              Height="20" IsSynchronizedWithCurrentItem="True" />
                                                </StackPanel>
                                            </Grid>
                                            <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="Auto" MinWidth="35" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel HorizontalAlignment="Left">
                                                    <Label Content="Capacity as percent of peak electric load"

                                                           Style="{DynamicResource PlantSettingStyle}" />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"

                                                            HorizontalAlignment="Right" Margin="0" Grid.ColumnSpan="2">
                                                    <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox Style="{DynamicResource TextBoxStyle}"
                                                             Text="{Binding OFF_CHP, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                </StackPanel>
                                            </Grid>
                                            <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="Auto" MinWidth="35" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel HorizontalAlignment="Left">
                                                    <Label Content="Electrical efficiency"
                                                           Style="{DynamicResource PlantSettingStyle}" />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"

                                                            HorizontalAlignment="Right" Margin="0" Grid.ColumnSpan="2">
                                                    <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox Style="{DynamicResource TextBoxStyle}"
                                                             Text="{Binding EFF_CHP, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                </StackPanel>
                                            </Grid>
                                            <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="Auto" MinWidth="35" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel HorizontalAlignment="Left">
                                                    <Label Content="Waste heat recovery effectiveness"
                                                           Style="{DynamicResource PlantSettingStyle}" />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"

                                                            HorizontalAlignment="Right" Margin="0" Grid.ColumnSpan="2">
                                                    <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox Style="{DynamicResource TextBoxStyle}"
                                                             Text="{Binding HREC_CHP, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                </StackPanel>
                                            </Grid>

                                        </StackPanel>
                                    </Grid>

                                </StackPanel>

                            </Border>
                        </Grid>

                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </TabItem>
        <TabItem Header="Results">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition/>
                </Grid.RowDefinitions>
                <Button Content="Run Simulation" Padding="5" Margin="5" Grid.Row="0" Click="RunSimulationClick">
                    <Button.IsEnabled>
                        <MultiBinding Converter="{StaticResource ButtonEnabled}" Mode="TwoWay">
                            <Binding ElementName="TurbineEff" Path="(Validation.HasError)" />
                            <Binding ElementName="AutHwt" Path="(Validation.HasError)" />
                            <Binding ElementName="AutBat" Path="(Validation.HasError)" />
                        </MultiBinding>
                    </Button.IsEnabled>
                </Button>
                <ScrollViewer Grid.Row="1">
                    <StackPanel>
                        <Grid Margin="20,20,20,0" Height="300">
                            <Grid.Effect>
                                <DropShadowEffect BlurRadius="15" Direction="-90" RenderingBias="Quality" Opacity=".2"
                                                  ShadowDepth="1" />
                            </Grid.Effect>
                            <Grid.Resources>
                                <districtEnergy:OpacityConverter x:Key="OpacityConverter"></districtEnergy:OpacityConverter>
                                <districtEnergy:ReverseConverter x:Key="ReverseConverter"></districtEnergy:ReverseConverter>
                            </Grid.Resources>
                            <Border CornerRadius="5" Background="White">
                                <Grid d:DataContext="{d:DesignData DHSimulateDistrictEnergy}">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="*" />
                                    </Grid.RowDefinitions>
                                    <TextBlock Grid.Row="0" FontSize="20" Foreground="#404040" Margin="20, 10">Energy Consumption</TextBlock>
                                    <Canvas x:Name="Canvas" Grid.Row="1" Margin="5, 0, 5, 10">
                                        <Canvas.DataContext>
                                            <vm:ResultsViewModel />
                                        </Canvas.DataContext>
                                        <ListBox Name="ListBox"
                                                 ItemsSource="{Binding StackedGraphSeries, Converter={StaticResource ReverseConverter}}"
                                                 PreviewMouseDown="ListBox_OnPreviewMouseDown"
                                                 Panel.ZIndex="1" Canvas.Left="60" Canvas.Top="20" BorderThickness="0"
                                                 Background="Transparent">
                                            <ListBox.ItemTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding (lvc:LineSeries.Title)}"
                                                               Foreground="{Binding (lvc:LineSeries.Fill)}"
                                                               Opacity="{Binding (lvc:LineSeries.Visibility), Converter={StaticResource OpacityConverter}}"
                                                               FontSize="22" />
                                                </DataTemplate>
                                            </ListBox.ItemTemplate>
                                            <ListBox.ItemContainerStyle>
                                                <Style TargetType="{x:Type ListBoxItem}">
                                                    <Setter Property="Background" Value="Transparent" />
                                                    <Setter Property="Template">
                                                        <Setter.Value>
                                                            <ControlTemplate TargetType="{x:Type ListBoxItem}">
                                                                <ContentPresenter />
                                                            </ControlTemplate>
                                                        </Setter.Value>
                                                    </Setter>
                                                </Style>
                                            </ListBox.ItemContainerStyle>
                                        </ListBox>
                                        <lvc:CartesianChart Height="{Binding ElementName=Canvas, Path=ActualHeight}"
                                                            Width="{Binding ElementName=Canvas, Path=ActualWidth}"
                                                            Series="{Binding StackedGraphSeries}" Hoverable="False"
                                                            LegendLocation="Bottom">
                                            <lvc:CartesianChart.AxisX>
                                                <lvc:Axis Title="Month" IsEnabled="False" ShowLabels="True">
                                                    <lvc:Axis.Separator>
                                                        <lvc:Separator IsEnabled="True" Step="1"></lvc:Separator>
                                                    </lvc:Axis.Separator>
                                                </lvc:Axis>
                                            </lvc:CartesianChart.AxisX>
                                            <lvc:CartesianChart.AxisY>
                                                <lvc:Axis Title="Energy" IsMerged="False" FontSize="14"
                                                          ShowLabels="True"
                                                          LabelFormatter="{Binding YFormatter}" />
                                            </lvc:CartesianChart.AxisY>
                                            <lvc:CartesianChart.DataTooltip>
                                                <lvc:DefaultTooltip BulletSize="20" Background="Gray" />
                                            </lvc:CartesianChart.DataTooltip>
                                        </lvc:CartesianChart>
                                    </Canvas>
                                </Grid>
                            </Border>
                        </Grid>
                        <Grid Margin="20,20,20,0">
                            <Grid.Effect>
                                <DropShadowEffect BlurRadius="15" Direction="-90" RenderingBias="Quality" Opacity=".2"
                                                  ShadowDepth="1" />
                            </Grid.Effect>
                            <Border CornerRadius="5" Background="White">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="*" />
                                    </Grid.RowDefinitions>
                                    <TextBlock FontSize="20" Foreground="#404040" Margin="10, 10">Energy Consumption</TextBlock>
                                    <Grid Margin="0,0,0,5" Grid.Row="1">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition />
                                            <ColumnDefinition />
                                            <ColumnDefinition />
                                        </Grid.ColumnDefinitions>
                                        <lvc:Gauge From="0" To="100" Value="50"
                                                   Height="100" Margin="10,0,5,0" />
                                        <lvc:Gauge From="0" To="100" Value="50" Grid.Column="1"
                                                   Height="100" Margin="5,0" />
                                        <lvc:Gauge From="0" To="100" Value="50" Grid.Column="2"
                                                   Height="100" Margin="5,0,10,0" />

                                    </Grid>

                                </Grid>
                            </Border>
                        </Grid>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="210*" />
                                <ColumnDefinition Width="210*" />
                            </Grid.ColumnDefinitions>
                            <Grid Margin="20,20,10,20">
                                <Grid.Effect>
                                    <DropShadowEffect BlurRadius="15" Direction="-90" RenderingBias="Quality"
                                                      Opacity=".2"
                                                      ShadowDepth="1" />
                                </Grid.Effect>
                                <Border CornerRadius="5" Background="White">
                                    <Grid Margin="0,0,0,5">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <TextBlock Grid.Row="0" FontSize="20" Foreground="#404040" Margin="10,5">Electricity</TextBlock>
                                        <StackPanel Grid.Row="1">
                                            <lvc:Gauge From="0" To="100" Value="{Binding Path=PurchasedElecIntensity}" Height="125" Margin="5,0" />
                                            <lvc:Gauge From="0" To="100" Value="50" Height="125" Margin="5,0" />
                                            <lvc:Gauge From="0" To="100" Value="50" Height="125" Margin="5,0" />
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </Grid>
                            <Grid Margin="10,20,20,20" Grid.Column="1">
                                <Grid.Effect>
                                    <DropShadowEffect BlurRadius="15" Direction="-90" RenderingBias="Quality"
                                                      Opacity=".2"
                                                      ShadowDepth="1" />
                                </Grid.Effect>
                                <Border CornerRadius="5" Background="White">
                                    <Grid Margin="0,0,0,5">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <TextBlock Grid.Row="0" FontSize="20" Foreground="#404040" Margin="10,5">Natural Gas</TextBlock>
                                        <StackPanel Grid.Row="1">
                                            <lvc:Gauge From="0" To="100" Value="50" Height="125" Margin="5,0" />
                                            <lvc:Gauge From="0" To="100" Value="50" Height="125" Margin="5,0" />
                                            <lvc:Gauge From="0" To="100" Value="50" Height="125" Margin="5,0" />
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </Grid>
                        </Grid>

                        <Grid Margin="20,20,20,20" Grid.Column="1">
                            <Grid.Effect>
                                <DropShadowEffect BlurRadius="15" Direction="-90" RenderingBias="Quality"
                                                  Opacity=".2"
                                                  ShadowDepth="1" />
                            </Grid.Effect>
                            <Border CornerRadius="5" Background="White">
                                <Grid Margin="0,0,0,5" d:DataContext="{d:DesignData SeriesAlgorithm}">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="*" />
                                    </Grid.RowDefinitions>
                                    <TextBlock Grid.Row="0" FontSize="20" Foreground="#404040" Margin="10,5">BreakDown</TextBlock>
                                    <lvc:PieChart Name="Chart" Grid.Row="1" Series="{Binding SeriesCollection}" 
                                                  LegendLocation="Right" InnerRadius="50" Margin="0 15" Height="200">
                                        <lvc:PieChart.ChartLegend>
                                            <lvc:DefaultLegend BulletSize="20"></lvc:DefaultLegend>
                                        </lvc:PieChart.ChartLegend>
                                        <lvc:PieChart.DataTooltip>
                                            <lvc:DefaultTooltip BulletSize="20"></lvc:DefaultTooltip>
                                        </lvc:PieChart.DataTooltip>
                                    </lvc:PieChart>

                                </Grid>
                            </Border>
                        </Grid>

                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </TabItem>
    </TabControl>


</UserControl>
<UserControl x:Class="DistrictEnergy.DistrictControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:districtEnergy="clr-namespace:DistrictEnergy"
             xmlns:vm="clr-namespace:DistrictEnergy.ViewModels"
             xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
             mc:Ignorable="d"
             d:DesignWidth="385" d:DesignHeight="1100" d:DataContext="{d:DesignData ResultsViewModel}">
    <UserControl.Resources>
        <Style x:Key="TextBoxInError" TargetType="{x:Type TextBox}">
            <Style.Triggers>
                <Trigger Property="Validation.HasError" Value="true">
                    <Setter Property="ToolTip"
                            Value="{Binding RelativeSource={x:Static RelativeSource.Self},
                              Path=(Validation.Errors)[0].ErrorContent}" />
                </Trigger>
            </Style.Triggers>
        </Style>
        <districtEnergy:InverseAndBooleansToBooleanConverter x:Key="ButtonEnabled" />
        <SolidColorBrush x:Key="TextBox.Static.Border" Color="#FFABAdB3" />
        <SolidColorBrush x:Key="TextBox.MouseOver.Border" Color="#FF7EB4EA" />
        <SolidColorBrush x:Key="TextBox.Focus.Border" Color="#FF569DE5" />
        <Style x:Key="TextBoxStyle" TargetType="{x:Type TextBox}">
            <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.WindowBrushKey}}" />
            <Setter Property="BorderBrush" Value="{StaticResource TextBox.Static.Border}" />
            <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="KeyboardNavigation.TabNavigation" Value="Cycle" />
            <Setter Property="HorizontalContentAlignment" Value="Left" />
            <Setter Property="FocusVisualStyle" Value="{x:Null}" />
            <Setter Property="ScrollViewer.PanningMode" Value="VerticalFirst" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
            <Setter Property="HorizontalAlignment" Value="Center" />
            <Setter Property="Width" Value="40" />
            <Setter Property="Height" Value="22" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type TextBox}">
                        <Border x:Name="border" BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                Background="{TemplateBinding Background}" SnapsToDevicePixels="True">
                            <ScrollViewer x:Name="PART_ContentHost" Focusable="false"
                                          HorizontalScrollBarVisibility="Hidden" VerticalScrollBarVisibility="Hidden" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsEnabled" Value="false">
                                <Setter Property="Opacity" TargetName="border" Value="0.56" />
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="true">
                                <Setter Property="BorderBrush" TargetName="border"
                                        Value="{StaticResource TextBox.MouseOver.Border}" />
                            </Trigger>
                            <Trigger Property="IsKeyboardFocused" Value="true">
                                <Setter Property="BorderBrush" TargetName="border"
                                        Value="{StaticResource TextBox.Focus.Border}" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <MultiTrigger>
                    <MultiTrigger.Conditions>
                        <Condition Property="IsInactiveSelectionHighlightEnabled" Value="true" />
                        <Condition Property="IsSelectionActive" Value="false" />
                    </MultiTrigger.Conditions>
                    <Setter Property="SelectionBrush"
                            Value="{DynamicResource {x:Static SystemColors.InactiveSelectionHighlightBrushKey}}" />
                </MultiTrigger>
            </Style.Triggers>

        </Style>
        <Style x:Key="PlantComponentHeader" TargetType="{x:Type TextBlock}">
            <Setter Property="TextWrapping" Value="NoWrap" />
            <Setter Property="TextTrimming" Value="None" />
            <Setter Property="Margin" Value="5, 5" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="Foreground" Value="#404040" />
        </Style>

    </UserControl.Resources>
    <TabControl x:Name="TabControl" HorizontalAlignment="Stretch" Margin="0,0,0,0" VerticalAlignment="Top"
                RenderTransformOrigin="0.501,0.507">
        <TabItem Header="Thermal Plant" IsSelected="True">
            <TabItem.Resources>
                <Style x:Key="PlantSettingStyle" TargetType="{x:Type Label}">
                    <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}" />
                    <Setter Property="Background" Value="Transparent" />
                    <Setter Property="Padding" Value="5" />
                    <Setter Property="HorizontalContentAlignment" Value="Left" />
                    <Setter Property="VerticalContentAlignment" Value="Center" />
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="{x:Type Label}">
                                <Border BorderBrush="{TemplateBinding BorderBrush}"
                                        BorderThickness="{TemplateBinding BorderThickness}"
                                        Background="{TemplateBinding Background}" SnapsToDevicePixels="true">
                                    <ContentPresenter
                                        HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                        RecognizesAccessKey="True"
                                        SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"
                                        VerticalAlignment="{TemplateBinding VerticalContentAlignment}" />
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsEnabled" Value="false">
                                        <Setter Property="Foreground"
                                                Value="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" />
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                    <Setter Property="Height" Value="Auto" />
                    <Setter Property="Margin" Value="0,2" />
                    <Setter Property="FontWeight" Value="Normal" />
                    <Setter Property="HorizontalAlignment" Value="Left" />
                </Style>
            </TabItem.Resources>
            <Grid ScrollViewer.CanContentScroll="True">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>
                <Button Content="Run Simulation" Padding="5" Margin="5" Grid.Row="0" Click="RunSimulationClick">
                    <Button.IsEnabled>
                        <MultiBinding Converter="{StaticResource ButtonEnabled}" Mode="TwoWay">
                            <Binding ElementName="TurbineEff" Path="(Validation.HasError)" />
                            <Binding ElementName="AutHwt" Path="(Validation.HasError)" />
                            <Binding ElementName="AutBat" Path="(Validation.HasError)" />
                        </MultiBinding>
                    </Button.IsEnabled>
                </Button>
                <ScrollViewer Grid.Row="1">
                    <StackPanel VerticalAlignment="Top" Width="Auto">
                        <StackPanel.Resources>
                            <Style x:Key="StackPanelStyle" TargetType="StackPanel">
                                <Setter Property="HorizontalAlignment" Value="Stretch" />
                                <Setter Property="VerticalAlignment" Value="Top" />
                                <Setter Property="Width" Value="Auto" />
                                <Setter Property="Margin" Value="5,0,5,5" />
                                <Setter Property="Background" Value="White" />
                            </Style>
                        </StackPanel.Resources>
                        <Grid Margin="10,0,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Grid.DataContext>
                                <vm:PlantSettingsViewModel />
                            </Grid.DataContext>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                                <Label Content="Account for network losses?"
                                       Style="{DynamicResource PlantSettingStyle}"
                                       ToolTip="Average annual ratio of useful heating delivered to electricity consumed" Margin="0,2,3,2" />
                                <CheckBox IsChecked="{Binding UseDistrictLosses, Mode=TwoWay}" VerticalAlignment="Center" />
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Grid.Column="1">

                                <Label Content="Hot"
                                       Style="{DynamicResource PlantSettingStyle}"
                                       ToolTip="Relative distribution heat loss" Margin="0,2,4,2" />
                                <TextBox Style="{DynamicResource TextBoxStyle}"
                                         Text="{Binding RelDistHeatLoss, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                <Label Content="Cold"
                                       Style="{DynamicResource PlantSettingStyle}"
                                       ToolTip="Average annual ratio of useful heating delivered to electricity consumed" Margin="0,2,4,2" />
                                <TextBox Style="{DynamicResource TextBoxStyle}"
                                         Text="{Binding RelDistCoolLoss, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                            </StackPanel>
                        </Grid>
                        <Grid x:Name="ChilledWaterGroup" Margin="10">
                            <Grid.Effect>
                                <DropShadowEffect BlurRadius="15" Direction="-90" RenderingBias="Quality"
                                                  Opacity=".3"
                                                  ShadowDepth="1" Color="DarkBlue" />
                            </Grid.Effect>
                            <Border CornerRadius="5" Background="White">
                                <StackPanel>
                                    <Grid x:Name="Abs">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <TextBlock Grid.Row="0" Style="{DynamicResource PlantComponentHeader}">Absorption Chiller</TextBlock>
                                        <StackPanel Grid.Row="1" HorizontalAlignment="Stretch" VerticalAlignment="Top"
                                                    Width="Auto"
                                                    Background="White" Margin="5,0,5,5">
                                            <Grid Margin="25,3,0,0" VerticalAlignment="Top" Panel.ZIndex="1">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" MinWidth="30" />
                                                    <ColumnDefinition Width="Auto" MinWidth="40" />
                                                </Grid.ColumnDefinitions>
                                                <Slider VerticalAlignment="Center" Margin="0" Maximum="100"
                                                        Value="{Binding OFF_ABS, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                        ToolTip="Capacity as percent of peak cooling load" IsSnapToTickEnabled="True" Focusable="False" />

                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox
                                                        Text="{Binding OFF_ABS, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                        Style="{DynamicResource TextBoxStyle}" UndoLimit="10" />

                                                </StackPanel>
                                            </Grid>
                                            <Expander Margin="0,-22,0,0">
                                                <Grid Margin="0,8,0,0" VerticalAlignment="Top">
                                                    <Grid.DataContext>
                                                        <vm:PlantSettingsViewModel />
                                                    </Grid.DataContext>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition />
                                                        <ColumnDefinition Width="Auto" MinWidth="30" />
                                                        <ColumnDefinition Width="Auto" MinWidth="40" />
                                                    </Grid.ColumnDefinitions>
                                                    <Label Content="Cooling coefficient of performance"
                                                           Style="{DynamicResource PlantSettingStyle}"
                                                           ToolTip="Average annual ratio of useful cooling delivered to natural gas consumed" />

                                                    <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                                Grid.ColumnSpan="2"
                                                                HorizontalAlignment="Right" Margin="0">
                                                        <TextBox Style="{DynamicResource TextBoxStyle}"
                                                                 Text="{Binding CCOP_ABS, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                    </StackPanel>
                                                </Grid>
                                            </Expander>
                                        </StackPanel>
                                    </Grid>
                                    <Grid x:Name="Ech" VerticalAlignment="Top"
                                          Height="Auto">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <TextBlock Grid.Row="0" Style="{DynamicResource PlantComponentHeader}">
                                            Electric Chiller
                                        </TextBlock>

                                        <StackPanel HorizontalAlignment="Stretch" VerticalAlignment="Top" Width="Auto"
                                                    Margin="5,0,5,5" Grid.Row="1">
                                            <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" MinWidth="30" />
                                                    <ColumnDefinition Width="Auto" MinWidth="35" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel HorizontalAlignment="Left">
                                                    <Label Content="Cooling coefficient of performance"
                                                           Style="{DynamicResource PlantSettingStyle}"
                                                           ToolTip="Average annual ratio of useful cooling delivered to electricity consumed" />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <TextBox Style="{DynamicResource TextBoxStyle}"
                                                             Text="{Binding CCOP_ECH, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                             UndoLimit="10" />
                                                </StackPanel>
                                            </Grid>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </Grid>
                        <Grid x:Name="HotWaterGroup" Margin="10">
                            <Grid.Effect>
                                <DropShadowEffect BlurRadius="15" Direction="-90" RenderingBias="Quality"
                                                  Opacity=".3"
                                                  ShadowDepth="1" Color="Crimson" />
                            </Grid.Effect>
                            <Border CornerRadius="5" Background="White">
                                <StackPanel>
                                    <Grid x:Name="Ehp" VerticalAlignment="Top" Height="Auto">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <TextBlock Grid.Row="0" Style="{DynamicResource PlantComponentHeader}">
                                            Electric Heat Pump
                                        </TextBlock>

                                        <StackPanel Grid.Row="1" Style="{StaticResource StackPanelStyle}">
                                            <Grid Margin="25,3,0,0" VerticalAlignment="Top" Panel.ZIndex="1">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" MinWidth="30" />
                                                    <ColumnDefinition Width="Auto" MinWidth="40" />
                                                </Grid.ColumnDefinitions>
                                                <Slider VerticalAlignment="Center" Margin="0" Maximum="100"
                                                        Value="{Binding OFF_EHP, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                        ToolTip="Ratio of heating delivered by heat pumps to total load at peak conditions" IsSnapToTickEnabled="True" Focusable="False" />
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox Style="{DynamicResource TextBoxStyle}"
                                                             Text="{Binding OFF_EHP, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                                                </StackPanel>
                                            </Grid>
                                            <Expander Margin="0,-22,0,0">
                                                <StackPanel>
                                                    <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                        <Grid.DataContext>
                                                            <vm:PlantSettingsViewModel />
                                                        </Grid.DataContext>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition />
                                                            <ColumnDefinition Width="Auto" MinWidth="30" />
                                                            <ColumnDefinition Width="Auto" MinWidth="35" />
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel HorizontalAlignment="Left">
                                                            <Label Content="Heating coefficient of performance"
                                                                   Style="{DynamicResource PlantSettingStyle}"
                                                                   ToolTip="Average annual ratio of useful heating delivered to electricity consumed" />
                                                        </StackPanel>
                                                        <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                                    Grid.ColumnSpan="2"
                                                                    HorizontalAlignment="Right" Margin="0">
                                                            <TextBox Style="{DynamicResource TextBoxStyle}"
                                                                     Text="{Binding HCOP_EHP, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                                                        </StackPanel>
                                                    </Grid>
                                                    <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                        <Grid.DataContext>
                                                            <vm:PlantSettingsViewModel />
                                                        </Grid.DataContext>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition />
                                                            <ColumnDefinition Width="Auto" MinWidth="30" />
                                                            <ColumnDefinition Width="Auto" MinWidth="35" />
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel HorizontalAlignment="Left">
                                                            <Label Content="Use Heating and Cooling simultaneously"
                                                               Style="{DynamicResource PlantSettingStyle}"
                                                               ToolTip="Average annual ratio of useful heating delivered to electricity consumed" />
                                                        </StackPanel>
                                                        <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                                Grid.ColumnSpan="2"
                                                                HorizontalAlignment="Right" Margin="0">
                                                            <CheckBox IsChecked="{Binding UseEhpEvap, Mode=TwoWay}" />
                                                        </StackPanel>
                                                    </Grid>
                                                </StackPanel>
                                            </Expander>

                                        </StackPanel>
                                    </Grid>
                                    <Grid x:Name="Shw" VerticalAlignment="Top" Height="Auto">

                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <TextBlock Grid.Row="0" Style="{DynamicResource PlantComponentHeader}">Solar Hot Water</TextBlock>

                                        <StackPanel Grid.Row="1" Style="{StaticResource StackPanelStyle}">

                                            <Grid Margin="25,3,0,0" VerticalAlignment="Top" Panel.ZIndex="1">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" MinWidth="30" />
                                                    <ColumnDefinition Width="Auto" MinWidth="40" />
                                                </Grid.ColumnDefinitions>
                                                <Slider VerticalAlignment="Center" Margin="0" Maximum="100"
                                                        Value="{Binding OFF_SHW, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                        ToolTip="Ratio of heating delivered by solar collectors to total annual heating requirement" IsSnapToTickEnabled="True" Focusable="False" />
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox Style="{DynamicResource TextBoxStyle}"
                                                             Text="{Binding OFF_SHW, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                </StackPanel>
                                            </Grid>
                                            <Expander Margin="0,-22,0,0">
                                                <StackPanel>
                                                    <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                        <Grid.DataContext>
                                                            <vm:PlantSettingsViewModel />
                                                        </Grid.DataContext>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition />
                                                            <ColumnDefinition Width="Auto" MinWidth="30" />
                                                            <ColumnDefinition Width="Auto" MinWidth="35" />
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel HorizontalAlignment="Left">
                                                            <Label Content="Collector efficiency"
                                                                   Style="{DynamicResource PlantSettingStyle}"
                                                                   ToolTip="Average annual ratio of the heat output from collectors divided by received solar radiation" />
                                                        </StackPanel>
                                                        <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                                    Grid.ColumnSpan="2"
                                                                    HorizontalAlignment="Right" Margin="0">
                                                            <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                                   VerticalContentAlignment="Center"
                                                                   HorizontalAlignment="Center" />
                                                            <TextBox Style="{DynamicResource TextBoxStyle}"
                                                                     Text="{Binding EFF_SHW, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                        </StackPanel>
                                                    </Grid>
                                                    <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                        <Grid.DataContext>
                                                            <vm:PlantSettingsViewModel />
                                                        </Grid.DataContext>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition />
                                                            <ColumnDefinition Width="Auto" MinWidth="30" />
                                                            <ColumnDefinition Width="Auto" MinWidth="35" />
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel HorizontalAlignment="Left">
                                                            <Label Content="Area utilization factor "
                                                                   ToolTip="Accounts for collector frames and other infrastructural requirements"
                                                                   Style="{DynamicResource PlantSettingStyle}" />
                                                        </StackPanel>
                                                        <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                                    Grid.ColumnSpan="2"
                                                                    HorizontalAlignment="Right" Margin="0">
                                                            <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                                   VerticalContentAlignment="Center"
                                                                   HorizontalAlignment="Center" />
                                                            <TextBox Style="{DynamicResource TextBoxStyle}"
                                                                     Text="{Binding UTIL_SHW, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                        </StackPanel>
                                                    </Grid>
                                                    <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                        <Grid.DataContext>
                                                            <vm:PlantSettingsViewModel />
                                                        </Grid.DataContext>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition />
                                                            <ColumnDefinition Width="Auto" MinWidth="30" />
                                                            <ColumnDefinition Width="Auto" MinWidth="35" />
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel HorizontalAlignment="Left">
                                                            <Label Content="Miscellaneous losses"
                                                                   Style="{DynamicResource PlantSettingStyle}"
                                                                   ToolTip="Accounts for other losses including leakage, distribution, or context shading" />
                                                        </StackPanel>
                                                        <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                                    Grid.ColumnSpan="2"
                                                                    HorizontalAlignment="Right" Margin="0">
                                                            <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                                   VerticalContentAlignment="Center"
                                                                   HorizontalAlignment="Center" />
                                                            <TextBox Style="{DynamicResource TextBoxStyle}"
                                                                     Text="{Binding LOSS_SHW, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                        </StackPanel>
                                                    </Grid>
                                                </StackPanel>
                                            </Expander>

                                        </StackPanel>
                                    </Grid>
                                    <Grid x:Name="Hwt" VerticalAlignment="Top" Height="Auto">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <TextBlock Grid.Row="0" Style="{DynamicResource PlantComponentHeader}">Hot Water Tank</TextBlock>
                                        <StackPanel Style="{StaticResource StackPanelStyle}" Grid.Row="1">
                                            <Grid Margin="25,3,0,0" VerticalAlignment="Top" Panel.ZIndex="1">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" MinWidth="30" />
                                                    <ColumnDefinition Width="Auto" MinWidth="35" />
                                                </Grid.ColumnDefinitions>
                                                <Slider VerticalAlignment="Center" Margin="0" Maximum="365"
                                                        Value="{Binding AUT_HWT, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                        ToolTip="Number of average annual days that tanks can meet demand once fully charged" IsSnapToTickEnabled="True" Focusable="False" />
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <Label Content="n days" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox x:Name="AutHwt"
                                                             Style="{DynamicResource TextBoxStyle}">
                                                        <TextBox.Text>
                                                            <Binding Path="AUT_HWT" BindsDirectlyToSource="True"
                                                                     Mode="TwoWay"
                                                                     UpdateSourceTrigger="PropertyChanged">
                                                                <Binding.ValidationRules>
                                                                    <districtEnergy:DoubleRangeRule Min="0" Max="365" />
                                                                </Binding.ValidationRules>
                                                            </Binding>
                                                        </TextBox.Text>
                                                    </TextBox>

                                                </StackPanel>
                                            </Grid>
                                            <Expander Margin="0,-22,0,0">
                                                <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                    <Grid.DataContext>
                                                        <vm:PlantSettingsViewModel />
                                                    </Grid.DataContext>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition />
                                                        <ColumnDefinition Width="Auto" MinWidth="30" />
                                                        <ColumnDefinition Width="Auto" MinWidth="35" />
                                                    </Grid.ColumnDefinitions>
                                                    <StackPanel HorizontalAlignment="Left">
                                                        <Label Content="Beginning Charged State"
                                                               Style="{DynamicResource PlantSettingStyle}"
                                                               ToolTip="The Charging State of the tank at the begining of the simulatino year (0: empty, 100: full)" />
                                                    </StackPanel>
                                                    <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                                Grid.ColumnSpan="2"
                                                                HorizontalAlignment="Right" Margin="0">
                                                        <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                               VerticalContentAlignment="Center"
                                                               HorizontalAlignment="Center" />
                                                        <TextBox Style="{DynamicResource TextBoxStyle}"
                                                                 Text="{Binding TANK_START, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                                                    </StackPanel>
                                                </Grid>
                                            </Expander>


                                        </StackPanel>
                                    </Grid>
                                    <Grid x:Name="Ngb" VerticalAlignment="Top" Height="Auto">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <TextBlock Grid.Row="0" Style="{DynamicResource PlantComponentHeader}">Natural Gas Boiler</TextBlock>
                                        <StackPanel Style="{StaticResource StackPanelStyle}" Grid.Row="1">
                                            <Grid VerticalAlignment="Top">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" MinWidth="30" />
                                                    <ColumnDefinition Width="Auto" MinWidth="35" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel HorizontalAlignment="Left">
                                                    <Label Content="Heating efficiency"
                                                           Style="{DynamicResource PlantSettingStyle}"
                                                           ToolTip="Average annual ratio of useful heating delivered to fuel consumed " />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox Style="{DynamicResource TextBoxStyle}"
                                                             Text="{Binding EFF_NGB, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                                                </StackPanel>
                                            </Grid>
                                        </StackPanel>
                                    </Grid>

                                </StackPanel>

                            </Border>
                        </Grid>
                        <Grid x:Name="ElectricGenGroup" Margin="10">
                            <Grid.Effect>
                                <DropShadowEffect BlurRadius="15" Direction="-90" RenderingBias="Quality"
                                                  Opacity=".3"
                                                  ShadowDepth="1" Color="Orange" />
                            </Grid.Effect>
                            <Border CornerRadius="5" Background="White">
                                <StackPanel>
                                    <Grid x:Name="Pv" VerticalAlignment="Top" Height="Auto">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <TextBlock Grid.Row="0" Style="{DynamicResource PlantComponentHeader}">
                                            Photovoltaic Array
                                        </TextBlock>
                                        <StackPanel Style="{StaticResource StackPanelStyle}"
                                                    Grid.Row="1">
                                            <Grid Margin="25,3,0,0" VerticalAlignment="Top" Panel.ZIndex="1">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" MinWidth="30" />
                                                    <ColumnDefinition Width="Auto" MinWidth="40" />
                                                </Grid.ColumnDefinitions>
                                                <Slider VerticalAlignment="Center" Margin="0" Maximum="100"
                                                        Value="{Binding OFF_PV, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                        ToolTip="Ratio of electricity delivered by PV Array to total annual electricity requirement" IsSnapToTickEnabled="True" Focusable="False" />
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox Style="{DynamicResource TextBoxStyle}"
                                                             Text="{Binding OFF_PV, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                                                </StackPanel>
                                            </Grid>
                                            <Expander Margin="0,-22,0,0">
                                                <StackPanel>
                                                    <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                        <Grid.DataContext>
                                                            <vm:PlantSettingsViewModel />
                                                        </Grid.DataContext>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition />
                                                            <ColumnDefinition Width="Auto" MinWidth="30" />
                                                            <ColumnDefinition Width="Auto" MinWidth="35" />
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel HorizontalAlignment="Left">
                                                            <Label Content="Cell efficiency"
                                                                   Style="{DynamicResource PlantSettingStyle}"
                                                                   ToolTip="Average annual ratio of electricity output from array divided by received solar radiation" />
                                                        </StackPanel>
                                                        <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                                    Grid.ColumnSpan="2"
                                                                    HorizontalAlignment="Right" Margin="0">
                                                            <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                                   VerticalContentAlignment="Center"
                                                                   HorizontalAlignment="Center" />
                                                            <TextBox Style="{DynamicResource TextBoxStyle}"
                                                                     Text="{Binding EFF_PV, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                                                        </StackPanel>
                                                    </Grid>
                                                    <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                        <Grid.DataContext>
                                                            <vm:PlantSettingsViewModel />
                                                        </Grid.DataContext>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition />
                                                            <ColumnDefinition Width="Auto" MinWidth="30" />
                                                            <ColumnDefinition Width="Auto" MinWidth="35" />
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel HorizontalAlignment="Left">
                                                            <Label Content="Area utilization factor"
                                                                   Style="{DynamicResource PlantSettingStyle}"
                                                                   ToolTip="Accounts for module frames and other infrastructural requirements" />
                                                        </StackPanel>
                                                        <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                                    Grid.ColumnSpan="2"
                                                                    HorizontalAlignment="Right" Margin="0">
                                                            <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                                   VerticalContentAlignment="Center"
                                                                   HorizontalAlignment="Center" />
                                                            <TextBox Style="{DynamicResource TextBoxStyle}"
                                                                     Text="{Binding UTIL_SHW, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                                                        </StackPanel>
                                                    </Grid>
                                                    <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                        <Grid.DataContext>
                                                            <vm:PlantSettingsViewModel />
                                                        </Grid.DataContext>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition />
                                                            <ColumnDefinition Width="Auto" MinWidth="30" />
                                                            <ColumnDefinition Width="Auto" MinWidth="35" />
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel HorizontalAlignment="Left">
                                                            <Label Content="Miscellaneous losses"
                                                                   Style="{DynamicResource PlantSettingStyle}"
                                                                   ToolTip="Accounts for other losses including line losses and balance of system" />
                                                        </StackPanel>
                                                        <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                                    Grid.ColumnSpan="2"
                                                                    HorizontalAlignment="Right" Margin="0">
                                                            <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                                   VerticalContentAlignment="Center"
                                                                   HorizontalAlignment="Center" />
                                                            <TextBox Style="{DynamicResource TextBoxStyle}"
                                                                     Text="{Binding LOSS_PV, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                        </StackPanel>
                                                    </Grid>
                                                </StackPanel>
                                            </Expander>

                                        </StackPanel>
                                    </Grid>
                                    <Grid x:Name="Wnd" VerticalAlignment="Top" Height="Auto">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <TextBlock Grid.Row="0" Style="{DynamicResource PlantComponentHeader}">
                                            Wind Turbines
                                        </TextBlock>
                                        <StackPanel Style="{StaticResource StackPanelStyle}"
                                                    Grid.Row="1">
                                            <Grid Margin="25,3,0,0" VerticalAlignment="Top" Panel.ZIndex="1">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" MinWidth="30" />
                                                    <ColumnDefinition Width="Auto" MinWidth="40" />
                                                </Grid.ColumnDefinitions>
                                                <Slider VerticalAlignment="Center" Margin="0" Maximum="100"
                                                        Value="{Binding OFF_WND, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                        ToolTip="Ratio of electricity delivered by wind turbines to total annual electricity requirement" IsSnapToTickEnabled="True" Focusable="False" />
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox Style="{DynamicResource TextBoxStyle}"
                                                             Text="{Binding OFF_WND, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                                                </StackPanel>
                                            </Grid>
                                            <Expander Margin="0,-22,0,0">
                                                <StackPanel>
                                                    <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                        <Grid.DataContext>
                                                            <vm:PlantSettingsViewModel />
                                                        </Grid.DataContext>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition />
                                                            <ColumnDefinition Width="Auto" />
                                                            <ColumnDefinition Width="Auto" MinWidth="35" />
                                                        </Grid.ColumnDefinitions>
                                                        <Label Content="Turbine efficiency"
                                                               Style="{DynamicResource PlantSettingStyle}"
                                                               ToolTip="Average annual ratio of power captured by turbine to total power available in the wind (Theoretical maximum is 59%)" />

                                                        <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                                    Grid.ColumnSpan="2"
                                                                    HorizontalAlignment="Right" Margin="0">
                                                            <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                                   VerticalContentAlignment="Center"
                                                                   HorizontalAlignment="Center" />
                                                            <TextBox x:Name="TurbineEff" Margin="0,2" MaxLines="1"
                                                                     Style="{StaticResource TextBoxInError}"
                                                                     VerticalContentAlignment="Center"
                                                                     HorizontalAlignment="Center"
                                                                     Width="40"
                                                                     AllowDrop="True"
                                                                     ToolTip="{Binding ElementName=TurbineEff, Path=(Validation.Errors)[0].ErrorContent}"
                                                                     Height="22">
                                                                <TextBox.Text>
                                                                    <Binding Path="EFF_WND"
                                                                             UpdateSourceTrigger="PropertyChanged">
                                                                        <Binding.ValidationRules>
                                                                            <districtEnergy:DoubleRangeRule Min="0"
                                                                                                            Max="59" />
                                                                        </Binding.ValidationRules>
                                                                    </Binding>
                                                                </TextBox.Text>
                                                            </TextBox>

                                                        </StackPanel>
                                                    </Grid>
                                                    <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                        <Grid.DataContext>
                                                            <vm:PlantSettingsViewModel />
                                                        </Grid.DataContext>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition />
                                                            <ColumnDefinition Width="Auto" />
                                                            <ColumnDefinition Width="Auto" />
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel HorizontalAlignment="Left">
                                                            <Label Content="Cut-in speed "
                                                                   Style="{DynamicResource PlantSettingStyle}"
                                                                   ToolTip="Minimum wind speed at which the turbine blades overcome friction and begin to rotate" />
                                                        </StackPanel>
                                                        <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                                    Grid.ColumnSpan="2"
                                                                    HorizontalAlignment="Right" Margin="0">
                                                            <Label Content="m/s" Margin="0,2,3,2" Padding="3,0,0,0"
                                                                   VerticalContentAlignment="Center"
                                                                   HorizontalAlignment="Center" />
                                                            <TextBox Style="{DynamicResource TextBoxStyle}"
                                                                     Text="{Binding CIN_WND, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                                                        </StackPanel>
                                                    </Grid>
                                                    <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                        <Grid.DataContext>
                                                            <vm:PlantSettingsViewModel />
                                                        </Grid.DataContext>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition />
                                                            <ColumnDefinition Width="Auto" />
                                                            <ColumnDefinition Width="Auto" />
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel HorizontalAlignment="Left">
                                                            <Label Content="Cut-out speed"
                                                                   Style="{DynamicResource PlantSettingStyle}"
                                                                   ToolTip="Speed at which the turbine blades are brought to rest to avoid damage from high winds" />
                                                        </StackPanel>
                                                        <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                                    Grid.ColumnSpan="2"
                                                                    HorizontalAlignment="Right" Margin="0">
                                                            <Label Content="m/s" Margin="0,2,3,2" Padding="3,0,0,0"
                                                                   VerticalContentAlignment="Center"
                                                                   HorizontalAlignment="Center" />
                                                            <TextBox Style="{DynamicResource TextBoxStyle}"
                                                                     Text="{Binding COUT_WND, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                        </StackPanel>
                                                    </Grid>
                                                    <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                        <Grid.DataContext>
                                                            <vm:PlantSettingsViewModel />
                                                        </Grid.DataContext>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition />
                                                            <ColumnDefinition Width="Auto" MinWidth="30" />
                                                            <ColumnDefinition Width="Auto" MinWidth="35" />
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel HorizontalAlignment="Left">
                                                            <Label Content="Rotor area per turbine"
                                                                   Style="{DynamicResource PlantSettingStyle}"
                                                                   ToolTip="The swept area is the plane of wind intersected by the turbine" />
                                                        </StackPanel>
                                                        <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                                    Grid.ColumnSpan="2"
                                                                    HorizontalAlignment="Right" Margin="0">
                                                            <Label Content="m²" Margin="0,2,3,2" Padding="3,0,0,0"
                                                                   VerticalContentAlignment="Center"
                                                                   HorizontalAlignment="Center" />
                                                            <TextBox Style="{DynamicResource TextBoxStyle}"
                                                                     Text="{Binding ROT_WND, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                        </StackPanel>
                                                    </Grid>
                                                    <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                        <Grid.DataContext>
                                                            <vm:PlantSettingsViewModel />
                                                        </Grid.DataContext>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition />
                                                            <ColumnDefinition Width="Auto" />
                                                            <ColumnDefinition Width="Auto" MinWidth="35" />
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel HorizontalAlignment="Left">
                                                            <Label Content="Miscellaneous losses"
                                                                   Style="{DynamicResource PlantSettingStyle}" />
                                                        </StackPanel>
                                                        <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                                    Grid.ColumnSpan="2"
                                                                    HorizontalAlignment="Right" Margin="0">
                                                            <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                                   VerticalContentAlignment="Center"
                                                                   HorizontalAlignment="Center" />
                                                            <TextBox Style="{DynamicResource TextBoxStyle}"
                                                                     Text="{Binding LOSS_WND, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                        </StackPanel>
                                                    </Grid>
                                                </StackPanel>
                                            </Expander>


                                        </StackPanel>
                                    </Grid>
                                    <Grid x:Name="Bat" VerticalAlignment="Top" Height="Auto">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <TextBlock Grid.Row="0" Style="{DynamicResource PlantComponentHeader}">
                                            Battery Bank
                                        </TextBlock>
                                        <StackPanel Style="{StaticResource StackPanelStyle}"
                                                    Grid.Row="1">
                                            <Grid Margin="25,3,0,0" VerticalAlignment="Top" Panel.ZIndex="1">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" MinWidth="50" />
                                                    <ColumnDefinition Width="Auto" MinWidth="35" />
                                                </Grid.ColumnDefinitions>
                                                <Slider VerticalAlignment="Center" Margin="0" Maximum="365"
                                                        Value="{Binding AUT_BAT, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                        ToolTip="Number of average annual days that batteries can meet demand once fully charged" IsSnapToTickEnabled="True" />
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            Grid.ColumnSpan="2"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <Label Content="n days" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox x:Name="AutBat"
                                                             Style="{DynamicResource TextBoxStyle}">
                                                        <TextBox.Text>
                                                            <Binding Path="AUT_BAT" BindsDirectlyToSource="True"
                                                                     Mode="TwoWay"
                                                                     UpdateSourceTrigger="PropertyChanged">
                                                                <Binding.ValidationRules>
                                                                    <districtEnergy:DoubleRangeRule Min="0" Max="365" />
                                                                </Binding.ValidationRules>
                                                            </Binding>
                                                        </TextBox.Text>
                                                    </TextBox>
                                                </StackPanel>
                                            </Grid>
                                            <Expander Margin="0,-22,0,0">
                                                <StackPanel>
                                                    <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                        <Grid.DataContext>
                                                            <vm:PlantSettingsViewModel />
                                                        </Grid.DataContext>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition />
                                                            <ColumnDefinition Width="Auto" />
                                                            <ColumnDefinition Width="Auto" MinWidth="35" />
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel HorizontalAlignment="Left">
                                                            <Label Content="Miscellaneous losses"
                                                                   Style="{DynamicResource PlantSettingStyle}"
                                                                   ToolTip="Accounts for other losses including line losses and balance of system" />
                                                        </StackPanel>
                                                        <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                                    Grid.ColumnSpan="2"
                                                                    HorizontalAlignment="Right" Margin="0">
                                                            <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                                   VerticalContentAlignment="Center"
                                                                   HorizontalAlignment="Center" />
                                                            <TextBox Style="{DynamicResource TextBoxStyle}"
                                                                     Text="{Binding LOSS_BAT, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                        </StackPanel>
                                                    </Grid>
                                                    <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                        <Grid.DataContext>
                                                            <vm:PlantSettingsViewModel />
                                                        </Grid.DataContext>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition />
                                                            <ColumnDefinition Width="Auto" MinWidth="30" />
                                                            <ColumnDefinition Width="Auto" MinWidth="35" />
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel HorizontalAlignment="Left">
                                                            <Label Content="Beginning Charged State"
                                                                   Style="{DynamicResource PlantSettingStyle}" />
                                                        </StackPanel>
                                                        <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                                    Grid.ColumnSpan="2"
                                                                    HorizontalAlignment="Right" Margin="0">
                                                            <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                                   VerticalContentAlignment="Center"
                                                                   HorizontalAlignment="Center" />
                                                            <TextBox Style="{DynamicResource TextBoxStyle}"
                                                                     Text="{Binding BAT_START, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                        </StackPanel>
                                                    </Grid>
                                                </StackPanel>
                                            </Expander>
                                        </StackPanel>
                                    </Grid>

                                </StackPanel>

                            </Border>
                        </Grid>
                        <Grid x:Name="ChpGroup" Margin="10">
                            <Grid.Effect>
                                <DropShadowEffect BlurRadius="15" Direction="-90" RenderingBias="Quality"
                                                  Opacity=".3"
                                                  ShadowDepth="1" Color="Black" />
                            </Grid.Effect>
                            <Border CornerRadius="5" Background="White">
                                <StackPanel>
                                    <Grid x:Name="Chp" VerticalAlignment="Top" Height="Auto">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <TextBlock Grid.Row="0" Style="{DynamicResource PlantComponentHeader}">
                                            Combined Heating &amp; Power
                                        </TextBlock>
                                        <StackPanel Style="{StaticResource StackPanelStyle}"
                                                    Grid.Row="1">
                                            <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" MinWidth="35" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel HorizontalAlignment="Left" Width="78">
                                                    <Label Content="Tracking mode"
                                                           Style="{DynamicResource PlantSettingStyle}"
                                                           ToolTip="Control the generator to prioritize meeting the hot water or electricity demand" />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"
                                                            HorizontalAlignment="Right" Margin="0">
                                                    <ComboBox SelectedItem="{Binding TMOD_CHP, Mode=TwoWay}"
                                                              ItemsSource="{Binding PosibleTrackingModes}"
                                                              Height="20" IsSynchronizedWithCurrentItem="True" Panel.ZIndex="2" Margin="0,0,1,0" />
                                                </StackPanel>
                                            </Grid>
                                            <Grid Margin="25,3,0,0" VerticalAlignment="Top" Panel.ZIndex="1">
                                                <Grid.DataContext>
                                                    <vm:PlantSettingsViewModel />
                                                </Grid.DataContext>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" MinWidth="30"/>
                                                    <ColumnDefinition Width="Auto" MinWidth="40" />
                                                </Grid.ColumnDefinitions>
                                                <Slider VerticalAlignment="Center" Margin="0" Maximum="100"
                                                        Value="{Binding OFF_CHP, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                        ToolTip="Ratio of electricity delivered by generator to total demand at peak conditions" IsSnapToTickEnabled="True" Focusable="False" />
                                                <StackPanel Orientation="Horizontal" Grid.Column="1"

                                                            HorizontalAlignment="Right" Margin="0" Grid.ColumnSpan="2">
                                                    <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                           VerticalContentAlignment="Center"
                                                           HorizontalAlignment="Center" />
                                                    <TextBox Style="{DynamicResource TextBoxStyle}"
                                                             Text="{Binding OFF_CHP, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,1,0" />
                                                </StackPanel>
                                            </Grid>
                                            <Expander Margin="0,-22,0,0">
                                                <StackPanel>
                                                    <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                        <Grid.DataContext>
                                                            <vm:PlantSettingsViewModel />
                                                        </Grid.DataContext>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition />
                                                            <ColumnDefinition Width="Auto" MinWidth="30" />
                                                            <ColumnDefinition Width="Auto" MinWidth="40" />
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel HorizontalAlignment="Left">
                                                            <Label Content="Electrical efficiency"
                                                                   Style="{DynamicResource PlantSettingStyle}"
                                                                   ToolTip="Average annual ratio of electricity delivered by generator to fuel consumed" />
                                                        </StackPanel>
                                                        <StackPanel Orientation="Horizontal" Grid.Column="1"

                                                                    HorizontalAlignment="Right" Margin="0"
                                                                    Grid.ColumnSpan="2">
                                                            <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                                   VerticalContentAlignment="Center"
                                                                   HorizontalAlignment="Center" />
                                                            <TextBox Style="{DynamicResource TextBoxStyle}"
                                                                     Text="{Binding EFF_CHP, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                        </StackPanel>
                                                    </Grid>
                                                    <Grid Margin="0,3,0,0" VerticalAlignment="Top">
                                                        <Grid.DataContext>
                                                            <vm:PlantSettingsViewModel />
                                                        </Grid.DataContext>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition />
                                                            <ColumnDefinition Width="Auto" />
                                                            <ColumnDefinition Width="Auto" MinWidth="35" />
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel HorizontalAlignment="Left">
                                                            <Label Content="Waste heat recovery effectiveness"
                                                                   Style="{DynamicResource PlantSettingStyle}"
                                                                   ToolTip="Average annual ratio of usable heat recovered from generator to fuel consumed " />
                                                        </StackPanel>
                                                        <StackPanel Orientation="Horizontal" Grid.Column="1" Margin="0"
                                                                    Grid.ColumnSpan="2" HorizontalAlignment="Right">
                                                            <Label Content="%" Margin="0,2,3,2" Padding="3,0,0,0"
                                                                   VerticalContentAlignment="Center"
                                                                   HorizontalAlignment="Center" />
                                                            <TextBox Style="{DynamicResource TextBoxStyle}"
                                                                     Text="{Binding HREC_CHP, BindsDirectlyToSource=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                        </StackPanel>
                                                    </Grid>
                                                </StackPanel>
                                            </Expander>

                                        </StackPanel>
                                    </Grid>

                                </StackPanel>

                            </Border>
                        </Grid>

                    </StackPanel>
                </ScrollViewer>

            </Grid>
        </TabItem>
        <TabItem Header="Sizing">
            <TabItem.Resources>
                <Style x:Key="SubMetricStackPanelStyle" TargetType="StackPanel">
                    <Setter Property="Margin" Value="5,0" />
                </Style>
            </TabItem.Resources>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition />
                </Grid.RowDefinitions>
                <Button Content="Run Simulation" Padding="5" Margin="5" Grid.Row="0" Click="RunSimulationClick">
                    <Button.IsEnabled>
                        <MultiBinding Converter="{StaticResource ButtonEnabled}" Mode="TwoWay">
                            <Binding ElementName="TurbineEff" Path="(Validation.HasError)" />
                            <Binding ElementName="AutHwt" Path="(Validation.HasError)" />
                            <Binding ElementName="AutBat" Path="(Validation.HasError)" />
                        </MultiBinding>
                    </Button.IsEnabled>
                </Button>
                <ScrollViewer Grid.Row="1">
                    <StackPanel>
                        <Grid Margin="10">
                            <Grid.Effect>
                                <DropShadowEffect BlurRadius="15" Direction="-90" RenderingBias="Quality"
                                                  Opacity=".3"
                                                  ShadowDepth="1" Color="DarkBlue" />
                            </Grid.Effect>
                            <Grid.DataContext>
                                <districtEnergy:SimConstants />
                            </Grid.DataContext>
                            <Border CornerRadius="5" Background="White">
                                <Grid Margin="5,5,5,10">
                                    <Grid.RowDefinitions>
                                        <RowDefinition />
                                        <RowDefinition />
                                    </Grid.RowDefinitions>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition />
                                            <ColumnDefinition />
                                            <ColumnDefinition />
                                        </Grid.ColumnDefinitions>
                                        <StackPanel>
                                            <StackPanel.Resources>
                                                <vm:KWConverter x:Key="KWConverter" />
                                                <vm:KWConverterUnit x:Key="KWConverterUnit" />
                                            </StackPanel.Resources>
                                            <TextBlock Style="{DynamicResource PlantComponentHeader}"
                                                       Text="Natural Gas Boiler" HorizontalAlignment="Center" />
                                            <TextBlock HorizontalAlignment="Center" Margin="5,0" TextWrapping="Wrap"
                                                       Text="{Binding CapNgb, Mode=OneWay, Converter={StaticResource KWConverter}}"
                                                       VerticalAlignment="Top" FontSize="36" />
                                            <TextBlock HorizontalAlignment="Center" Margin="0" TextWrapping="Wrap"
                                                       Text="{Binding CapNgb, Mode=OneWay, Converter={StaticResource KWConverterUnit}}"
                                                       VerticalAlignment="Top" />
                                            <TextBlock HorizontalAlignment="Center" Margin="0" TextWrapping="Wrap"
                                                       Text="Installed" VerticalAlignment="Top" />
                                        </StackPanel>
                                        <StackPanel Grid.Column="1">
                                            <StackPanel.Resources>
                                                <vm:KWConverter x:Key="KwConverter" />
                                                <vm:KWConverterUnit x:Key="KwConverterUnit" />
                                            </StackPanel.Resources>
                                            <TextBlock HorizontalAlignment="Center"
                                                       Style="{DynamicResource PlantComponentHeader}"
                                                       Text="Electric Heat Pump" />
                                            <TextBlock HorizontalAlignment="Center" Margin="5,0" TextWrapping="Wrap"
                                                       Text="{Binding CapEhp, Converter={StaticResource KwConverter}}"
                                                       VerticalAlignment="Top" FontSize="36" />
                                            <TextBlock HorizontalAlignment="Center" Margin="0" TextWrapping="Wrap"
                                                       Text="{Binding CapEhp, Converter={StaticResource KwConverterUnit}}"
                                                       VerticalAlignment="Top" />
                                            <TextBlock HorizontalAlignment="Center" Margin="0" TextWrapping="Wrap"
                                                       Text="Installed" VerticalAlignment="Top" />
                                        </StackPanel>
                                        <StackPanel Grid.Column="2">
                                            <StackPanel.Resources>
                                                <vm:KWConverter x:Key="KWConverter" />
                                                <vm:KWConverterUnit x:Key="KWConverterUnit" />
                                            </StackPanel.Resources>
                                            <TextBlock HorizontalAlignment="Center"
                                                       Style="{DynamicResource PlantComponentHeader}"
                                                       Text="CHP Hot Water" />
                                            <TextBlock HorizontalAlignment="Center" Margin="5,0" TextWrapping="Wrap"
                                                       Text="{Binding CapChpElec, Converter={StaticResource KWConverter}}"
                                                       VerticalAlignment="Top" FontSize="36" />
                                            <TextBlock HorizontalAlignment="Center" Margin="0" TextWrapping="Wrap"
                                                       Text="{Binding CapChpElec, Converter={StaticResource KWConverterUnit}}"
                                                       VerticalAlignment="Top" />
                                            <TextBlock HorizontalAlignment="Center" Margin="0" TextWrapping="Wrap"
                                                       Text="Installed" VerticalAlignment="Top" />
                                        </StackPanel>
                                    </Grid>
                                    <Grid Grid.Row="1" Margin="0,10,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition />
                                            <ColumnDefinition />
                                        </Grid.ColumnDefinitions>
                                        <StackPanel VerticalAlignment="Center">
                                            <TextBlock HorizontalAlignment="Center"
                                                       Style="{DynamicResource PlantComponentHeader}"
                                                       Text="Solar Hot Water" />
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel Grid.Column="0" HorizontalAlignment="Right"
                                                            Style="{StaticResource SubMetricStackPanelStyle}">
                                                    <StackPanel.Resources>
                                                        <vm:KWConverter x:Key="KWConverter" />
                                                        <vm:KWConverterUnit x:Key="KWConverterUnit" />
                                                    </StackPanel.Resources>
                                                    <TextBlock HorizontalAlignment="Center" Margin="5,0"
                                                               TextWrapping="Wrap"
                                                               Text="{Binding CapShw, Converter={StaticResource KWConverter}}"
                                                               VerticalAlignment="Top" FontSize="24" />
                                                    <TextBlock HorizontalAlignment="Center" Margin="0"
                                                               TextWrapping="Wrap"
                                                               Text="{Binding CapShw, Converter={StaticResource KWConverterUnit}}"
                                                               VerticalAlignment="Top" />
                                                    <TextBlock HorizontalAlignment="Center" Margin="0"
                                                               TextWrapping="Wrap"
                                                               VerticalAlignment="Top">
                                                        <Run Text="Installed " /><Run Text="Capacity" />
                                                    </TextBlock>
                                                </StackPanel>
                                                <StackPanel Grid.Column="1" HorizontalAlignment="Left"
                                                            Style="{StaticResource SubMetricStackPanelStyle}">
                                                    <StackPanel.Resources>
                                                        <vm:AreaConverter x:Key="AreaConverter" />
                                                        <vm:AreaConverterUnit x:Key="AreaConverterUnit" />
                                                    </StackPanel.Resources>
                                                    <TextBlock HorizontalAlignment="Center" Margin="5,0"
                                                               TextWrapping="Wrap"
                                                               Text="{Binding AreaShw, Converter={StaticResource AreaConverter}}"
                                                               VerticalAlignment="Top" FontSize="24" />
                                                    <TextBlock HorizontalAlignment="Center" Margin="0"
                                                               TextWrapping="Wrap"
                                                               Text="{Binding AreaShw, Converter={StaticResource AreaConverterUnit}}"
                                                               VerticalAlignment="Top" />
                                                    <TextBlock HorizontalAlignment="Center" Margin="0"
                                                               TextWrapping="Wrap"
                                                               Text="Solar Panels" VerticalAlignment="Top" />
                                                </StackPanel>
                                            </Grid>
                                        </StackPanel>
                                        <StackPanel Grid.Column="1">
                                            <TextBlock HorizontalAlignment="Center"
                                                       Style="{DynamicResource PlantComponentHeader}"
                                                       Text="Hot Water Tank" />
                                            <StackPanel>
                                                <StackPanel.Resources>
                                                    <vm:KWhConverter x:Key="KWhConverter" />
                                                    <vm:KWhConverterUnit x:Key="KWhConverterUnit" />
                                                </StackPanel.Resources>
                                                <TextBlock HorizontalAlignment="Center" Margin="5,0"
                                                           TextWrapping="Wrap"
                                                           Text="{Binding CapHwt, Converter={StaticResource KWhConverter}}"
                                                           VerticalAlignment="Top" FontSize="36" />
                                                <TextBlock HorizontalAlignment="Center" Margin="0" TextWrapping="Wrap"
                                                           Text="{Binding CapHwt, Converter={StaticResource KWhConverterUnit}}"
                                                           VerticalAlignment="Top" />
                                                <TextBlock HorizontalAlignment="Center" Margin="0" TextWrapping="Wrap"
                                                           Text="Storage Capacity" VerticalAlignment="Top" />
                                            </StackPanel>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition />
                                                </Grid.ColumnDefinitions>
                                                <Grid.Resources>
                                                    <vm:KWhConverter x:Key="KWhConverter" />
                                                    <vm:KWhConverterUnit x:Key="KWhConverterUnit" />
                                                </Grid.Resources>
                                                <StackPanel HorizontalAlignment="Right"
                                                            Style="{StaticResource SubMetricStackPanelStyle}"
                                                            Margin="5,5,5,0">
                                                    <TextBlock HorizontalAlignment="Center" Margin="0"
                                                               TextWrapping="Wrap"
                                                               Text="Charging Rate" VerticalAlignment="Top" />

                                                    <TextBlock HorizontalAlignment="Center" Margin="5,0"
                                                               TextWrapping="Wrap"
                                                               Text="{Binding ChgrHwt, Converter={StaticResource KWhConverter}}"
                                                               VerticalAlignment="Top" FontSize="24" />
                                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                        <TextBlock HorizontalAlignment="Center" Margin="0"
                                                                   TextWrapping="Wrap"
                                                                   Text="{Binding ChgrHwt, Converter={StaticResource KWhConverterUnit}}"
                                                                   VerticalAlignment="Top" />
                                                        <TextBlock HorizontalAlignment="Center" Margin="0"
                                                                   Text="/h"
                                                                   VerticalAlignment="Top" />
                                                    </StackPanel>

                                                </StackPanel>
                                                <StackPanel Grid.Column="1" HorizontalAlignment="Left"
                                                            Style="{StaticResource SubMetricStackPanelStyle}"
                                                            Margin="5,5,5,0">
                                                    <TextBlock HorizontalAlignment="Center" Margin="0"
                                                               TextWrapping="Wrap"
                                                               Text="Discharging Rate" VerticalAlignment="Top" />

                                                    <TextBlock HorizontalAlignment="Center" Margin="5,0"
                                                               TextWrapping="Wrap"
                                                               Text="{Binding DchgrHwt, Converter={StaticResource KWhConverter}}"
                                                               VerticalAlignment="Top" FontSize="24" />
                                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                        <TextBlock HorizontalAlignment="Center" Margin="0"
                                                                   TextWrapping="Wrap"
                                                                   Text="{Binding DchgrHwt, Converter={StaticResource KWhConverterUnit}}"
                                                                   VerticalAlignment="Top" />
                                                        <TextBlock HorizontalAlignment="Center" Margin="0"
                                                                   Text="/h"
                                                                   VerticalAlignment="Top" />
                                                    </StackPanel>

                                                </StackPanel>

                                            </Grid>
                                        </StackPanel>
                                    </Grid>
                                </Grid>


                            </Border>

                        </Grid>
                        <Grid Margin="10">
                            <Grid.Effect>
                                <DropShadowEffect BlurRadius="15" Direction="-90" RenderingBias="Quality"
                                                  Opacity=".3"
                                                  ShadowDepth="1" Color="DarkBlue" />
                            </Grid.Effect>
                            <Grid.DataContext>
                                <districtEnergy:SimConstants />
                            </Grid.DataContext>
                            <Border CornerRadius="5" Background="White">
                                <Grid Margin="5,5,5,10">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition />
                                        <ColumnDefinition />
                                    </Grid.ColumnDefinitions>
                                    <StackPanel>
                                        <StackPanel.Resources>
                                            <vm:KWConverter x:Key="KWConverter" />
                                            <vm:KWConverterUnit x:Key="KWConverterUnit" />
                                        </StackPanel.Resources>
                                        <TextBlock HorizontalAlignment="Center"
                                                   Style="{DynamicResource PlantComponentHeader}"
                                                   Text="Absorption Chiller" />
                                        <TextBlock HorizontalAlignment="Center" Margin="5,0" TextWrapping="Wrap"
                                                   Text="{Binding CapAbs, Mode=OneWay, Converter={StaticResource KWConverter}}"
                                                   VerticalAlignment="Top" FontSize="36" />
                                        <TextBlock HorizontalAlignment="Center" Margin="0" TextWrapping="Wrap"
                                                   Text="{Binding CapAbs, Mode=OneWay, Converter={StaticResource KWConverterUnit}}"
                                                   VerticalAlignment="Top" />
                                        <TextBlock HorizontalAlignment="Center" Margin="0" TextWrapping="Wrap"
                                                   Text="Installed" VerticalAlignment="Top" />
                                    </StackPanel>
                                    <StackPanel Grid.Column="1">
                                        <StackPanel.Resources>
                                            <vm:KWConverter x:Key="KWConverter" />
                                            <vm:KWConverterUnit x:Key="KWConverterUnit" />
                                        </StackPanel.Resources>
                                        <TextBlock HorizontalAlignment="Center"
                                                   Style="{DynamicResource PlantComponentHeader}"
                                                   Text="Electric Chiller" />
                                        <TextBlock HorizontalAlignment="Center" Margin="5,0" TextWrapping="Wrap"
                                                   Text="{Binding CapEch, Mode=OneWay, Converter={StaticResource KWConverter}}"
                                                   VerticalAlignment="Top" FontSize="36" />
                                        <TextBlock HorizontalAlignment="Center" Margin="0" TextWrapping="Wrap"
                                                   Text="{Binding CapEch, Mode=OneWay, Converter={StaticResource KWConverterUnit}}"
                                                   VerticalAlignment="Top" />
                                        <TextBlock HorizontalAlignment="Center" Margin="0" TextWrapping="Wrap"
                                                   Text="Installed" VerticalAlignment="Top" />
                                    </StackPanel>

                                </Grid>
                            </Border>
                        </Grid>
                        <Grid Margin="10">
                            <Grid.Effect>
                                <DropShadowEffect BlurRadius="15" Direction="-90" RenderingBias="Quality"
                                                  Opacity=".3"
                                                  ShadowDepth="1" Color="DarkBlue" />
                            </Grid.Effect>
                            <Grid.DataContext>
                                <districtEnergy:SimConstants />
                            </Grid.DataContext>
                            <Border CornerRadius="5" Background="White">
                                <Grid Margin="5,5,5,10">
                                    <Grid.RowDefinitions>
                                        <RowDefinition />
                                        <RowDefinition />
                                        <RowDefinition />
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition />
                                        <ColumnDefinition />
                                    </Grid.ColumnDefinitions>
                                    <StackPanel>
                                        <StackPanel.Resources>
                                            <vm:KWConverter x:Key="KWConverter" />
                                            <vm:KWConverterUnit x:Key="KWConverterUnit" />
                                        </StackPanel.Resources>
                                        <TextBlock HorizontalAlignment="Center"
                                                   Style="{DynamicResource PlantComponentHeader}"
                                                   Text="Grid Electricity" />
                                        <TextBlock HorizontalAlignment="Center" Margin="5,0" TextWrapping="Wrap"
                                                   Text="{Binding CapElecProj, Mode=OneWay, Converter={StaticResource KWConverter}}"
                                                   VerticalAlignment="Top" FontSize="36" />
                                        <TextBlock HorizontalAlignment="Center" Margin="0" TextWrapping="Wrap"
                                                   Text="{Binding CapElecProj, Mode=OneWay, Converter={StaticResource KWConverterUnit}}"
                                                   VerticalAlignment="Top" />
                                        <TextBlock HorizontalAlignment="Center" Margin="0" TextWrapping="Wrap"
                                                   Text="Strain on grid" VerticalAlignment="Top" />
                                    </StackPanel>
                                    <StackPanel Grid.Row="0" Grid.Column="1">
                                        <StackPanel.Resources>
                                            <vm:KWConverter x:Key="KWConverter" />
                                            <vm:KWConverterUnit x:Key="KWConverterUnit" />
                                        </StackPanel.Resources>
                                        <TextBlock HorizontalAlignment="Center"
                                                   Style="{DynamicResource PlantComponentHeader}"
                                                   Text="CHP Elec" />
                                        <TextBlock HorizontalAlignment="Center" Margin="5,0" TextWrapping="Wrap"
                                                   Text="{Binding CapChpElec, Mode=OneWay, Converter={StaticResource KWConverter}}"
                                                   VerticalAlignment="Top" FontSize="36" />
                                        <TextBlock HorizontalAlignment="Center" Margin="0" TextWrapping="Wrap"
                                                   Text="{Binding CapChpElec, Mode=OneWay, Converter={StaticResource KWConverterUnit}}"
                                                   VerticalAlignment="Top" />
                                        <TextBlock HorizontalAlignment="Center" Margin="0" TextWrapping="Wrap"
                                                   Text="Installed" VerticalAlignment="Top" />
                                    </StackPanel>
                                    <StackPanel Grid.Row="1" Margin="0,10,0,0">
                                        <TextBlock HorizontalAlignment="Center"
                                                   Style="{DynamicResource PlantComponentHeader}"
                                                   Text="PV" />
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition />
                                                <ColumnDefinition />
                                            </Grid.ColumnDefinitions>
                                            <StackPanel Grid.Column="0" HorizontalAlignment="Right"
                                                        Style="{StaticResource SubMetricStackPanelStyle}">
                                                <StackPanel.Resources>
                                                    <vm:KWConverter x:Key="KWConverter" />
                                                    <vm:KWConverterUnit x:Key="KWConverterUnit" />
                                                </StackPanel.Resources>
                                                <TextBlock HorizontalAlignment="Center" Margin="5,0"
                                                           TextWrapping="Wrap"
                                                           Text="{Binding CapPv, Mode=OneWay, Converter={StaticResource KWConverter}}"
                                                           VerticalAlignment="Top" FontSize="24" />
                                                <TextBlock HorizontalAlignment="Center" Margin="0" TextWrapping="Wrap"
                                                           Text="{Binding CapPv, Mode=OneWay, Converter={StaticResource KWConverterUnit}}"
                                                           VerticalAlignment="Top" />
                                                <TextBlock HorizontalAlignment="Center" Margin="0" TextWrapping="Wrap"
                                                           Text="Installed Capacity" VerticalAlignment="Top" />
                                            </StackPanel>
                                            <StackPanel Grid.Column="1" HorizontalAlignment="Left"
                                                        Style="{StaticResource SubMetricStackPanelStyle}">
                                                <StackPanel.Resources>
                                                    <vm:AreaConverter x:Key="AreaConverter" />
                                                    <vm:AreaConverterUnit x:Key="AreaConverterUnit" />
                                                </StackPanel.Resources>
                                                <TextBlock HorizontalAlignment="Center" Margin="5,0"
                                                           TextWrapping="Wrap"
                                                           Text="{Binding AreaPv, Mode=OneWay, Converter={StaticResource AreaConverter}}"
                                                           VerticalAlignment="Top" FontSize="24" />
                                                <TextBlock HorizontalAlignment="Center" Margin="0" TextWrapping="Wrap"
                                                           Text="{Binding AreaPv, Mode=OneWay, Converter={StaticResource AreaConverterUnit}}"
                                                           VerticalAlignment="Top" />
                                                <TextBlock HorizontalAlignment="Center" Margin="0" TextWrapping="Wrap"
                                                           Text="Solar Panels" VerticalAlignment="Top" />
                                            </StackPanel>

                                        </Grid>
                                    </StackPanel>
                                    <StackPanel Grid.Row="1" Grid.Column="1" Margin="0,10,0,0">
                                        <TextBlock HorizontalAlignment="Center"
                                                   Style="{DynamicResource PlantComponentHeader}"
                                                   Text="Wind" />
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition />
                                                <ColumnDefinition />
                                            </Grid.ColumnDefinitions>
                                            <StackPanel Grid.Column="0" HorizontalAlignment="Right"
                                                        Style="{StaticResource SubMetricStackPanelStyle}">
                                                <StackPanel.Resources>
                                                    <vm:KWConverter x:Key="KWConverter" />
                                                    <vm:KWConverterUnit x:Key="KWConverterUnit" />
                                                </StackPanel.Resources>
                                                <TextBlock HorizontalAlignment="Center" Margin="5,0"
                                                           TextWrapping="Wrap"
                                                           Text="{Binding CapWnd, Mode=OneWay, Converter={StaticResource KWConverter}}"
                                                           VerticalAlignment="Top" FontSize="24" />
                                                <TextBlock HorizontalAlignment="Center" Margin="0" TextWrapping="Wrap"
                                                           Text="{Binding CapWnd, Mode=OneWay, Converter={StaticResource KWConverterUnit}}"
                                                           VerticalAlignment="Top" />
                                                <TextBlock HorizontalAlignment="Center" Margin="0" TextWrapping="Wrap"
                                                           Text="Installed Capacity" VerticalAlignment="Top" />
                                            </StackPanel>
                                            <StackPanel Grid.Column="1" HorizontalAlignment="Left"
                                                        Style="{StaticResource SubMetricStackPanelStyle}">
                                                <StackPanel.Resources>
                                                    <vm:AreaConverter x:Key="AreaConverter" />
                                                    <vm:AreaConverterUnit x:Key="AreaConverterUnit" />
                                                </StackPanel.Resources>
                                                <TextBlock HorizontalAlignment="Center" Margin="5,0"
                                                           TextWrapping="Wrap"
                                                           Text="{Binding NumWnd, Mode=OneWay, StringFormat=N0}"
                                                           VerticalAlignment="Top" FontSize="24" />
                                                <TextBlock HorizontalAlignment="Center" Margin="0" TextWrapping="Wrap"
                                                           Text="Wind Turbines" VerticalAlignment="Top" />
                                            </StackPanel>

                                        </Grid>
                                    </StackPanel>
                                    <StackPanel Grid.Column="1" Grid.Row="2">
                                        <TextBlock HorizontalAlignment="Center"
                                                   Style="{DynamicResource PlantComponentHeader}"
                                                   Text="Battery" />
                                        <StackPanel>
                                            <StackPanel.Resources>
                                                <vm:KWhConverter x:Key="KWhConverter" />
                                                <vm:KWhConverterUnit x:Key="KWhConverterUnit" />
                                            </StackPanel.Resources>
                                            <TextBlock HorizontalAlignment="Center" Margin="5,0"
                                                       TextWrapping="Wrap"
                                                       Text="{Binding CapBat, Converter={StaticResource KWhConverter}}"
                                                       VerticalAlignment="Top" FontSize="36" />
                                            <TextBlock HorizontalAlignment="Center" Margin="0" TextWrapping="Wrap"
                                                       Text="{Binding CapBat, Converter={StaticResource KWhConverterUnit}}"
                                                       VerticalAlignment="Top" />
                                            <TextBlock HorizontalAlignment="Center" Margin="0" TextWrapping="Wrap"
                                                       Text="Storage Capacity" VerticalAlignment="Top" />
                                        </StackPanel>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition />
                                                <ColumnDefinition />
                                            </Grid.ColumnDefinitions>
                                            <Grid.Resources>
                                                <vm:KWhConverter x:Key="KWhConverter" />
                                                <vm:KWhConverterUnit x:Key="KWhConverterUnit" />
                                            </Grid.Resources>
                                            <StackPanel HorizontalAlignment="Right"
                                                        Style="{StaticResource SubMetricStackPanelStyle}"
                                                        Margin="5,5,5,0">
                                                <TextBlock HorizontalAlignment="Center" Margin="0"
                                                           TextWrapping="Wrap"
                                                           Text="Charging Rate" VerticalAlignment="Top" />

                                                <TextBlock HorizontalAlignment="Center" Margin="5,0"
                                                           TextWrapping="Wrap"
                                                           Text="{Binding ChgrBat, Converter={StaticResource KWhConverter}}"
                                                           VerticalAlignment="Top" FontSize="24" />
                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                    <TextBlock HorizontalAlignment="Center" Margin="0"
                                                               TextWrapping="Wrap"
                                                               Text="{Binding ChgrBat, Converter={StaticResource KWhConverterUnit}}"
                                                               VerticalAlignment="Top" />
                                                    <TextBlock HorizontalAlignment="Center" Margin="0"
                                                               Text="/h"
                                                               VerticalAlignment="Top" />
                                                </StackPanel>

                                            </StackPanel>
                                            <StackPanel Grid.Column="1" HorizontalAlignment="Left"
                                                        Style="{StaticResource SubMetricStackPanelStyle}"
                                                        Margin="5,5,5,0">
                                                <TextBlock HorizontalAlignment="Center" Margin="0"
                                                           TextWrapping="Wrap"
                                                           Text="Discharging Rate" VerticalAlignment="Top" />

                                                <TextBlock HorizontalAlignment="Center" Margin="5,0"
                                                           TextWrapping="Wrap"
                                                           Text="{Binding DchgBat, Converter={StaticResource KWhConverter}}"
                                                           VerticalAlignment="Top" FontSize="24" />
                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                    <TextBlock HorizontalAlignment="Center" Margin="0"
                                                               TextWrapping="Wrap"
                                                               Text="{Binding DchgBat, Converter={StaticResource KWhConverterUnit}}"
                                                               VerticalAlignment="Top" />
                                                    <TextBlock HorizontalAlignment="Center" Margin="0"
                                                               Text="/h"
                                                               VerticalAlignment="Top" />
                                                </StackPanel>

                                            </StackPanel>

                                        </Grid>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </Grid>

                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </TabItem>
        <TabItem Header="Results">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition />
                </Grid.RowDefinitions>
                <Button Content="Run Simulation" Padding="5" Margin="5" Grid.Row="0" Click="RunSimulationClick">
                    <Button.IsEnabled>
                        <MultiBinding Converter="{StaticResource ButtonEnabled}" Mode="TwoWay">
                            <Binding ElementName="TurbineEff" Path="(Validation.HasError)" />
                            <Binding ElementName="AutHwt" Path="(Validation.HasError)" />
                            <Binding ElementName="AutBat" Path="(Validation.HasError)" />
                        </MultiBinding>
                    </Button.IsEnabled>
                </Button>
                <ScrollViewer Grid.Row="1">
                    <StackPanel>
                        <Grid Margin="20,20,20,0">
                            <UniformGrid Columns="3">
                                <FrameworkElement x:Name="C1" />
                                <!-- no need to add the other three -->
                            </UniformGrid>
                            <TabControl x:Name="StackedGraphsTabControl">
                                <TabControl.Resources>
                                    <Style TargetType="TabControl">
                                        <Setter Property="OverridesDefaultStyle" Value="True" />
                                        <Setter Property="SnapsToDevicePixels" Value="True" />
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="TabControl">
                                                    <Grid KeyboardNavigation.TabNavigation="Local">
                                                        <Grid.Effect>
                                                            <DropShadowEffect BlurRadius="15" Direction="-90"
                                                                              RenderingBias="Quality" Opacity=".2"
                                                                              ShadowDepth="1" />
                                                        </Grid.Effect>
                                                        <Grid.RowDefinitions>
                                                            <RowDefinition Height="Auto" />
                                                            <RowDefinition Height="*" />
                                                        </Grid.RowDefinitions>
                                                        <TabPanel
                                                            Name="HeaderPanel"
                                                            Grid.Row="0"
                                                            Panel.ZIndex="1"

                                                            IsItemsHost="True"
                                                            KeyboardNavigation.TabIndex="1"
                                                            Background="Transparent" />
                                                        <Border
                                                            Name="Border"
                                                            Grid.Row="1"
                                                            Background="White"
                                                            BorderBrush="Transparent"
                                                            BorderThickness="1"
                                                            CornerRadius="2"
                                                            Margin="0,-1,0,0"
                                                            KeyboardNavigation.TabNavigation="Local"
                                                            KeyboardNavigation.DirectionalNavigation="Contained"
                                                            KeyboardNavigation.TabIndex="2">
                                                            <ContentPresenter
                                                                Name="PART_SelectedContentHost"
                                                                ContentSource="SelectedContent" />
                                                        </Border>
                                                    </Grid>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsEnabled" Value="False">
                                                            <Setter Property="Foreground" Value="Gray" />
                                                            <Setter TargetName="Border" Property="BorderBrush"
                                                                    Value="Transparent" />
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>

                                    <Style TargetType="TabItem">
                                        <Setter Property="OverridesDefaultStyle" Value="True" />
                                        <Setter Property="SnapsToDevicePixels" Value="True" />
                                        <Setter Property="FontSize" Value="16" />
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="TabItem">
                                                    <Border Name="Border" BorderThickness="1,1,1,0"
                                                            BorderBrush="Gainsboro"
                                                            CornerRadius="4,4,0,0">
                                                        <ContentPresenter x:Name="ContentSite"
                                                                          VerticalAlignment="Center"
                                                                          HorizontalAlignment="Center"
                                                                          ContentSource="Header"
                                                                          Margin="10,2" />
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsSelected" Value="True">
                                                            <Setter TargetName="Border" Property="Background"
                                                                    Value="White" />
                                                        </Trigger>
                                                        <Trigger Property="IsSelected" Value="False">
                                                            <Setter TargetName="Border" Property="Background"
                                                                    Value="LightSlateGray" />
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>

                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </TabControl.Resources>
                                <TabItem Header="Heating demand"
                                         Width="{Binding ElementName=C1, Path=ActualWidth}">
                                    <Grid Height="300"
                                          Width="{Binding ActualWidth, ElementName=StackedGraphsTabControl, Mode=OneWay}">
                                        <Grid.Effect>
                                            <DropShadowEffect BlurRadius="15" Direction="-90" RenderingBias="Quality"
                                                              Opacity=".2"
                                                              ShadowDepth="1" />
                                        </Grid.Effect>
                                        <Grid.Resources>
                                            <districtEnergy:OpacityConverter x:Key="OpacityConverter" />
                                            <districtEnergy:ReverseConverter x:Key="ReverseConverter" />
                                        </Grid.Resources>
                                        <Border CornerRadius="5" Background="White">
                                            <Grid d:DataContext="{d:DesignData DHSimulateDistrictEnergy}">
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto" />
                                                    <RowDefinition Height="*" />
                                                </Grid.RowDefinitions>
                                                <TextBlock Grid.Row="0" FontSize="20" Foreground="#404040"
                                                           Margin="20, 10">
                                                    <Run Text="Energy Consumption" /><Run Text=" by Source" />
                                                </TextBlock>
                                                <Canvas x:Name="HeatingCanvas" Grid.Row="1" Margin="5, 0, 5, 10">
                                                    <Canvas.DataContext>
                                                        <vm:ResultsViewModel />
                                                    </Canvas.DataContext>
                                                    <ListBox Name="HeatingListBox"
                                                             ItemsSource="{Binding StackedHeatingSeries, Converter={StaticResource ReverseConverter}}"
                                                             PreviewMouseDown="ListBox_OnPreviewMouseDown"
                                                             Panel.ZIndex="1" Canvas.Left="80" Canvas.Top="20"
                                                             BorderThickness="0"
                                                             Background="Transparent">
                                                        <ListBox.ItemTemplate>
                                                            <DataTemplate>
                                                                <TextBlock Text="{Binding (lvc:LineSeries.Title)}"
                                                                           Foreground="{Binding (lvc:LineSeries.Fill)}"
                                                                           Opacity="{Binding (lvc:LineSeries.Visibility), Converter={StaticResource OpacityConverter}}"
                                                                           FontSize="14" />
                                                            </DataTemplate>
                                                        </ListBox.ItemTemplate>
                                                        <ListBox.ItemContainerStyle>
                                                            <Style TargetType="{x:Type ListBoxItem}">
                                                                <Setter Property="Background" Value="Transparent" />
                                                                <Setter Property="Template">
                                                                    <Setter.Value>
                                                                        <ControlTemplate
                                                                            TargetType="{x:Type ListBoxItem}">
                                                                            <ContentPresenter />
                                                                        </ControlTemplate>
                                                                    </Setter.Value>
                                                                </Setter>
                                                            </Style>
                                                        </ListBox.ItemContainerStyle>
                                                    </ListBox>
                                                    <lvc:CartesianChart
                                                        Height="{Binding ElementName=HeatingCanvas, Path=ActualHeight}"
                                                        Width="{Binding ElementName=HeatingCanvas, Path=ActualWidth}"
                                                        Series="{Binding StackedHeatingSeries}" Hoverable="False"
                                                        LegendLocation="Bottom">
                                                        <lvc:CartesianChart.AxisX>
                                                            <lvc:Axis Title="Month" IsEnabled="False" ShowLabels="True"
                                                                      LabelFormatter="{Binding MonthFormater}">
                                                                <lvc:Axis.Separator>
                                                                    <lvc:Separator IsEnabled="True" Step="1" />
                                                                </lvc:Axis.Separator>
                                                            </lvc:Axis>
                                                        </lvc:CartesianChart.AxisX>
                                                        <lvc:CartesianChart.AxisY>
                                                            <lvc:Axis Title="Energy" IsMerged="False" FontSize="14"
                                                                      ShowLabels="True"
                                                                      LabelFormatter="{Binding KWhFormatter}" />
                                                        </lvc:CartesianChart.AxisY>
                                                        <lvc:CartesianChart.DataTooltip>
                                                            <lvc:DefaultTooltip BulletSize="20" Background="Gray" />
                                                        </lvc:CartesianChart.DataTooltip>
                                                    </lvc:CartesianChart>
                                                </Canvas>
                                            </Grid>
                                        </Border>
                                    </Grid>
                                </TabItem>
                                <TabItem Header="Cooling demand"
                                         Width="{Binding ElementName=C1, Path=ActualWidth}">
                                    <Grid Height="300"
                                          Width="{Binding ActualWidth, ElementName=StackedGraphsTabControl, Mode=OneWay}">
                                        <Grid.Effect>
                                            <DropShadowEffect BlurRadius="15" Direction="-90" RenderingBias="Quality"
                                                              Opacity=".2"
                                                              ShadowDepth="1" />
                                        </Grid.Effect>
                                        <Grid.Resources>
                                            <districtEnergy:OpacityConverter x:Key="OpacityConverter" />
                                            <districtEnergy:ReverseConverter x:Key="ReverseConverter" />
                                        </Grid.Resources>
                                        <Border CornerRadius="5" Background="White">
                                            <Grid d:DataContext="{d:DesignData DHSimulateDistrictEnergy}">
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto" />
                                                    <RowDefinition Height="*" />
                                                </Grid.RowDefinitions>
                                                <TextBlock Grid.Row="0" FontSize="20" Foreground="#404040"
                                                           Margin="20, 10">
                                                    <Run Text="Energy Consumption" /><Run Text=" by Source" />
                                                </TextBlock>
                                                <Canvas x:Name="CoolingCanvas" Grid.Row="1" Margin="5, 0, 5, 10">
                                                    <Canvas.DataContext>
                                                        <vm:ResultsViewModel />
                                                    </Canvas.DataContext>
                                                    <ListBox Name="CoolingListBox"
                                                             ItemsSource="{Binding StackedCoolingSeries, Converter={StaticResource ReverseConverter}}"
                                                             PreviewMouseDown="ListBox_OnPreviewMouseDown"
                                                             Panel.ZIndex="1" Canvas.Left="80" Canvas.Top="20"
                                                             BorderThickness="0"
                                                             Background="Transparent">
                                                        <ListBox.ItemTemplate>
                                                            <DataTemplate>
                                                                <TextBlock Text="{Binding (lvc:LineSeries.Title)}"
                                                                           Foreground="{Binding (lvc:LineSeries.Fill)}"
                                                                           Opacity="{Binding (lvc:LineSeries.Visibility), Converter={StaticResource OpacityConverter}}"
                                                                           FontSize="14" />
                                                            </DataTemplate>
                                                        </ListBox.ItemTemplate>
                                                        <ListBox.ItemContainerStyle>
                                                            <Style TargetType="{x:Type ListBoxItem}">
                                                                <Setter Property="Background" Value="Transparent" />
                                                                <Setter Property="Template">
                                                                    <Setter.Value>
                                                                        <ControlTemplate
                                                                            TargetType="{x:Type ListBoxItem}">
                                                                            <ContentPresenter />
                                                                        </ControlTemplate>
                                                                    </Setter.Value>
                                                                </Setter>
                                                            </Style>
                                                        </ListBox.ItemContainerStyle>
                                                    </ListBox>
                                                    <lvc:CartesianChart
                                                        Height="{Binding ElementName=CoolingCanvas, Path=ActualHeight}"
                                                        Width="{Binding ElementName=CoolingCanvas, Path=ActualWidth}"
                                                        Series="{Binding StackedCoolingSeries}" Hoverable="False"
                                                        LegendLocation="Bottom">
                                                        <lvc:CartesianChart.AxisX>
                                                            <lvc:Axis Title="Month" IsEnabled="False" ShowLabels="True"
                                                                      LabelFormatter="{Binding MonthFormater}">
                                                                <lvc:Axis.Separator>
                                                                    <lvc:Separator IsEnabled="True" Step="1" />
                                                                </lvc:Axis.Separator>
                                                            </lvc:Axis>
                                                        </lvc:CartesianChart.AxisX>
                                                        <lvc:CartesianChart.AxisY>
                                                            <lvc:Axis Title="Energy" IsMerged="False" FontSize="14"
                                                                      ShowLabels="True"
                                                                      LabelFormatter="{Binding KWhFormatter}" />
                                                        </lvc:CartesianChart.AxisY>
                                                        <lvc:CartesianChart.DataTooltip>
                                                            <lvc:DefaultTooltip BulletSize="20" Background="Gray" />
                                                        </lvc:CartesianChart.DataTooltip>
                                                    </lvc:CartesianChart>
                                                </Canvas>
                                            </Grid>
                                        </Border>
                                    </Grid>
                                </TabItem>
                                <TabItem Header="Electricity demand"
                                         Width="{Binding ElementName=C1, Path=ActualWidth}">
                                    <Grid Height="300"
                                          Width="{Binding ActualWidth, ElementName=StackedGraphsTabControl, Mode=OneWay}">
                                        <Grid.Effect>
                                            <DropShadowEffect BlurRadius="15" Direction="-90" RenderingBias="Quality"
                                                              Opacity=".2"
                                                              ShadowDepth="1" />
                                        </Grid.Effect>
                                        <Grid.Resources>
                                            <districtEnergy:OpacityConverter x:Key="OpacityConverter" />
                                            <districtEnergy:ReverseConverter x:Key="ReverseConverter" />
                                        </Grid.Resources>
                                        <Border CornerRadius="5" Background="White">
                                            <Grid d:DataContext="{d:DesignData DHSimulateDistrictEnergy}">
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto" />
                                                    <RowDefinition Height="*" />
                                                </Grid.RowDefinitions>
                                                <TextBlock Grid.Row="0" FontSize="20" Foreground="#404040"
                                                           Margin="20, 10">
                                                    <Run Text="Energy Consumption" /><Run Text=" by Source" />
                                                </TextBlock>
                                                <Canvas x:Name="ElecCanvas" Grid.Row="1" Margin="5, 0, 5, 10">
                                                    <Canvas.DataContext>
                                                        <vm:ResultsViewModel />
                                                    </Canvas.DataContext>
                                                    <ListBox Name="ElecListBox"
                                                             ItemsSource="{Binding StackedElecSeries, Converter={StaticResource ReverseConverter}}"
                                                             PreviewMouseDown="ListBox_OnPreviewMouseDown"
                                                             Panel.ZIndex="1" Canvas.Left="80" Canvas.Top="20"
                                                             BorderThickness="0"
                                                             Background="Transparent">
                                                        <ListBox.ItemTemplate>
                                                            <DataTemplate>
                                                                <TextBlock Text="{Binding (lvc:LineSeries.Title)}"
                                                                           Foreground="{Binding (lvc:LineSeries.Fill)}"
                                                                           Opacity="{Binding (lvc:LineSeries.Visibility), Converter={StaticResource OpacityConverter}}"
                                                                           FontSize="14" />
                                                            </DataTemplate>
                                                        </ListBox.ItemTemplate>
                                                        <ListBox.ItemContainerStyle>
                                                            <Style TargetType="{x:Type ListBoxItem}">
                                                                <Setter Property="Background" Value="Transparent" />
                                                                <Setter Property="Template">
                                                                    <Setter.Value>
                                                                        <ControlTemplate
                                                                            TargetType="{x:Type ListBoxItem}">
                                                                            <ContentPresenter />
                                                                        </ControlTemplate>
                                                                    </Setter.Value>
                                                                </Setter>
                                                            </Style>
                                                        </ListBox.ItemContainerStyle>
                                                    </ListBox>
                                                    <lvc:CartesianChart
                                                        Height="{Binding ElementName=ElecCanvas, Path=ActualHeight}"
                                                        Width="{Binding ElementName=ElecCanvas, Path=ActualWidth}"
                                                        Series="{Binding StackedElecSeries}" Hoverable="False"
                                                        LegendLocation="Bottom">
                                                        <lvc:CartesianChart.AxisX>
                                                            <lvc:Axis Title="Month" IsEnabled="False" ShowLabels="True"
                                                                      LabelFormatter="{Binding MonthFormater}">
                                                                <lvc:Axis.Separator>
                                                                    <lvc:Separator IsEnabled="True" Step="1" />
                                                                </lvc:Axis.Separator>
                                                            </lvc:Axis>
                                                        </lvc:CartesianChart.AxisX>
                                                        <lvc:CartesianChart.AxisY>
                                                            <lvc:Axis Title="Energy" IsMerged="False" FontSize="14"
                                                                      ShowLabels="True"
                                                                      LabelFormatter="{Binding KWhFormatter}" />
                                                        </lvc:CartesianChart.AxisY>
                                                        <lvc:CartesianChart.DataTooltip>
                                                            <lvc:DefaultTooltip BulletSize="20" Background="Gray" />
                                                        </lvc:CartesianChart.DataTooltip>
                                                    </lvc:CartesianChart>
                                                </Canvas>
                                            </Grid>
                                        </Border>
                                    </Grid>
                                </TabItem>
                            </TabControl>
                        </Grid>
                        <Grid Margin="20,20,20,0">
                            <Grid.Effect>
                                <DropShadowEffect BlurRadius="15" Direction="-90" RenderingBias="Quality" Opacity=".2"
                                                  ShadowDepth="1" />
                            </Grid.Effect>
                            <Border CornerRadius="5" Background="White">
                                <Grid>
                                    <Grid.DataContext>
                                        <vm:ResultsViewModel />
                                    </Grid.DataContext>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="*" />
                                    </Grid.RowDefinitions>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition />
                                        </Grid.ColumnDefinitions>
                                        <TextBlock FontSize="20" Foreground="#404040" Margin="10,10,10,10">Source Energy Consumption</TextBlock>
                                        <TextBlock FontSize="12" Foreground="#FF838383" Margin="10,19,10,12"
                                                   Grid.Column="1" VerticalAlignment="Center">
                                            Annual
                                        </TextBlock>
                                    </Grid>
                                    <Grid Margin="0,0,0,18" Grid.Row="1">
                                        <Grid.Resources>
                                            <vm:KWConverter x:Key="KWConverter" />
                                            <vm:KWConverterUnit x:Key="KWConverterUnit" />
                                        </Grid.Resources>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition />
                                            <ColumnDefinition />
                                            <ColumnDefinition />
                                        </Grid.ColumnDefinitions>
                                        <TextBlock HorizontalAlignment="Center" Margin="5,0" TextWrapping="Wrap"
                                                   Text="{Binding TotalEnergyIntensity, Converter={StaticResource KWConverter}}"
                                                   VerticalAlignment="Top" FontSize="36" />
                                        <TextBlock HorizontalAlignment="Center" Margin="5,0" TextWrapping="Wrap"
                                                   Text="{Binding TotalCarbonIntensity, Converter={StaticResource KWConverter}}"
                                                   VerticalAlignment="Top" FontSize="36" Grid.Column="1" />

                                        <TextBlock HorizontalAlignment="Center" Margin="5,0" TextWrapping="Wrap"
                                                   Text="{Binding TotalCostIntensity, Converter={StaticResource KWConverter}}"
                                                   VerticalAlignment="Top" FontSize="36" Grid.Column="2" />

                                    </Grid>
                                    <Grid Grid.Row="1" Margin="0,0,0,18">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition />
                                            <ColumnDefinition />
                                            <ColumnDefinition />
                                        </Grid.ColumnDefinitions>
                                        <TextBlock HorizontalAlignment="Center" Margin="0,0,0,-8" TextWrapping="Wrap"
                                                   Text="kWh/m²" VerticalAlignment="Bottom" FontSize="10" />
                                        <TextBlock HorizontalAlignment="Center" Margin="0,0,0,-8" TextWrapping="Wrap"
                                                   Text="kgCO₂eq/m²" VerticalAlignment="Bottom"
                                                   Grid.Column="1" FontSize="10" />
                                        <TextBlock HorizontalAlignment="Center" Margin="0,0,0,-8" TextWrapping="Wrap"
                                                   Text="$/m²" VerticalAlignment="Bottom"
                                                   Grid.Column="2" FontSize="10" />
                                    </Grid>


                                </Grid>
                            </Border>
                        </Grid>
                        <Grid Margin="20,20,20,0">
                            <Grid.Effect>
                                <DropShadowEffect BlurRadius="15" Direction="-90" RenderingBias="Quality" Opacity=".2"
                                                  ShadowDepth="1" />
                            </Grid.Effect>
                            <Border CornerRadius="5" Background="White">
                                <Grid>
                                    <Grid.DataContext>
                                        <vm:ResultsViewModel />
                                    </Grid.DataContext>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="*" />
                                    </Grid.RowDefinitions>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition />
                                        </Grid.ColumnDefinitions>
                                        <TextBlock FontSize="20" Foreground="#404040" Margin="10,10,10,10">Supplied Energy Breakdown</TextBlock>
                                    </Grid>
                                    <Grid Margin="0,0,0,5" Grid.Row="1">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition />
                                            <ColumnDefinition />
                                            <ColumnDefinition />
                                        </Grid.ColumnDefinitions>
                                        <Label Content="Share of gas needed to meet each component"
                                               HorizontalAlignment="Left" Margin="5,-13,0,0" VerticalAlignment="Top"
                                               Grid.ColumnSpan="2" />
                                        <lvc:Gauge From="0" To="100" Value="{Binding GasToChw}"
                                                   LabelFormatter="{Binding GaugeFormatter}"
                                                   Height="100" Margin="10,0,5,0" />
                                        <lvc:Gauge From="0" To="100" Value="{Binding GasToHw}"
                                                   LabelFormatter="{Binding GaugeFormatter}"
                                                   Grid.Column="1"
                                                   Height="100" Margin="5,0" />
                                        <lvc:Gauge From="0" To="100" Value="{Binding GasToElec}"
                                                   Grid.Column="2" LabelFormatter="{Binding GaugeFormatter}"
                                                   Height="100" Margin="5,0,10,0" />

                                    </Grid>
                                    <Grid Grid.Row="1">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition />
                                            <ColumnDefinition />
                                            <ColumnDefinition />
                                        </Grid.ColumnDefinitions>
                                        <TextBlock HorizontalAlignment="Center" Margin="0,0,0,41" TextWrapping="Wrap"
                                                   Text="chw" VerticalAlignment="Bottom" FontSize="10" />
                                        <TextBlock HorizontalAlignment="Center" Margin="0,0,0,41" TextWrapping="Wrap"
                                                   Text="hw" VerticalAlignment="Bottom"
                                                   Grid.Column="1" FontSize="10" />
                                        <TextBlock HorizontalAlignment="Center" Margin="0,0,0,41" TextWrapping="Wrap"
                                                   Text="elec" VerticalAlignment="Bottom"
                                                   Grid.Column="2" FontSize="10" />
                                    </Grid>
                                    <Grid Margin="0,10,0,5" Grid.Row="2">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition />
                                            <ColumnDefinition />
                                            <ColumnDefinition />
                                        </Grid.ColumnDefinitions>
                                        <Label Content="Share of electricity needed to meet each component"
                                               HorizontalAlignment="Left" Margin="5,-13,0,0" VerticalAlignment="Top"
                                               Grid.ColumnSpan="2" />
                                        <lvc:Gauge From="0" To="100" Value="{Binding ElecToChw}"
                                                   LabelFormatter="{Binding GaugeFormatter}"
                                                   Height="100" Margin="10,0,5,0" />
                                        <lvc:Gauge From="0" To="100" Value="{Binding ElecToHw}"
                                                   LabelFormatter="{Binding GaugeFormatter}"
                                                   Grid.Column="1"
                                                   Height="100" Margin="5,0" />
                                        <lvc:Gauge From="0" To="100" Value="{Binding ElecToElec}"
                                                   Grid.Column="2" LabelFormatter="{Binding GaugeFormatter}"
                                                   Height="100" Margin="5,0,10,0" />

                                    </Grid>
                                    <Grid Grid.Row="2">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition />
                                            <ColumnDefinition />
                                            <ColumnDefinition />
                                        </Grid.ColumnDefinitions>
                                        <TextBlock HorizontalAlignment="Center" Margin="0,0,0,41" TextWrapping="Wrap"
                                                   Text="chw" VerticalAlignment="Bottom" FontSize="10" />
                                        <TextBlock HorizontalAlignment="Center" Margin="0,0,0,41" TextWrapping="Wrap"
                                                   Text="hw" VerticalAlignment="Bottom"
                                                   Grid.Column="1" FontSize="10" />
                                        <TextBlock HorizontalAlignment="Center" Margin="0,0,0,41" TextWrapping="Wrap"
                                                   Text="elec" VerticalAlignment="Bottom"
                                                   Grid.Column="2" FontSize="10" />
                                    </Grid>
                                </Grid>
                            </Border>
                        </Grid>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="210*" />
                                <ColumnDefinition Width="210*" />
                            </Grid.ColumnDefinitions>
                            <Grid Margin="20,20,10,0">
                                <Grid.Effect>
                                    <DropShadowEffect BlurRadius="15" Direction="-90" RenderingBias="Quality"
                                                      Opacity=".2"
                                                      ShadowDepth="1" />
                                </Grid.Effect>
                                <Border CornerRadius="5" Background="White">
                                    <Grid Margin="0,0,0,5">
                                        <Grid.DataContext>
                                            <vm:ResultsViewModel />
                                        </Grid.DataContext>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <TextBlock Grid.Row="0" FontSize="20" Foreground="#404040" Margin="10,5">Electricity</TextBlock>
                                        <StackPanel Grid.Row="1">
                                            <StackPanel.Resources>
                                                <vm:KWhConverter x:Key="KWhConverter" />
                                                <vm:KWhConverterUnit x:Key="KWhConverterUnit" />
                                            </StackPanel.Resources>
                                            <TextBlock HorizontalAlignment="Center" Margin="5,0" TextWrapping="Wrap"
                                                       Text="{Binding PurchasedElec, Converter={StaticResource KWhConverter}}"
                                                       VerticalAlignment="Top" FontSize="48" />
                                            <TextBlock HorizontalAlignment="Center" Margin="0" TextWrapping="Wrap"
                                                       Text="{Binding PurchasedElec, Converter={StaticResource KWhConverterUnit}}"
                                                       VerticalAlignment="Top" />
                                            <TextBlock HorizontalAlignment="Center" Margin="0" TextWrapping="Wrap"
                                                       Text="Purchased" VerticalAlignment="Top" />

                                            <lvc:Gauge From="0" To="100" Value="{Binding PurchasedElecIntensity}"
                                                       LabelFormatter="{Binding GaugeFormatter}" Height="125"
                                                       Margin="10,0,10,10" />
                                        </StackPanel>
                                        <TextBlock HorizontalAlignment="Center" Margin="0,0,0,50" TextWrapping="Wrap"
                                                   Text="kWh/m²" VerticalAlignment="Bottom" Grid.Row="1" />

                                    </Grid>
                                </Border>
                            </Grid>
                            <Grid Margin="10,20,20,0" Grid.Column="1">
                                <Grid.Effect>
                                    <DropShadowEffect BlurRadius="15" Direction="-90" RenderingBias="Quality"
                                                      Opacity=".2"
                                                      ShadowDepth="1" />
                                </Grid.Effect>
                                <Border CornerRadius="5" Background="White">
                                    <Grid Margin="0,0,0,5">
                                        <Grid.DataContext>
                                            <vm:ResultsViewModel />
                                        </Grid.DataContext>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <TextBlock Grid.Row="0" FontSize="20" Foreground="#404040" Margin="10,5">Natural Gas</TextBlock>
                                        <StackPanel Grid.Row="1">
                                            <StackPanel.Resources>
                                                <vm:KWhConverter x:Key="KWhConverter" />
                                                <vm:KWhConverterUnit x:Key="KWhConverterUnit" />
                                            </StackPanel.Resources>
                                            <TextBlock HorizontalAlignment="Center" Margin="5,0" TextWrapping="Wrap"
                                                       Text="{Binding PurchasedNgas, Converter={StaticResource KWhConverter}}"
                                                       VerticalAlignment="Top" FontSize="48" />
                                            <TextBlock HorizontalAlignment="Center" Margin="0" TextWrapping="Wrap"
                                                       Text="{Binding PurchasedNgas, Converter={StaticResource KWhConverterUnit}}"
                                                       VerticalAlignment="Top" />
                                            <TextBlock HorizontalAlignment="Center" Margin="0" TextWrapping="Wrap"
                                                       Text="Purchased" VerticalAlignment="Top" />

                                            <lvc:Gauge From="0" To="100"
                                                       Value="{Binding PurchasedNgasIntensity}"
                                                       LabelFormatter="{Binding GaugeFormatter}"
                                                       Height="125" Margin="10,0,10,10" />
                                        </StackPanel>
                                        <TextBlock HorizontalAlignment="Center" Margin="0,0,0,50" TextWrapping="Wrap"
                                                   Text="kWh/m²" VerticalAlignment="Bottom" Grid.Row="1" />

                                    </Grid>
                                </Border>
                            </Grid>
                        </Grid>

                        <Grid Margin="20,20,20,20">
                            <Grid.Effect>
                                <DropShadowEffect BlurRadius="15" Direction="-90" RenderingBias="Quality"
                                                  Opacity=".2"
                                                  ShadowDepth="1" />
                            </Grid.Effect>
                            <Border CornerRadius="5" Background="White">
                                <Grid Margin="0,0,0,5" d:DataContext="{d:DesignData SeriesAlgorithm}">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="*" />
                                    </Grid.RowDefinitions>
                                    <Grid.DataContext>
                                        <vm:ResultsViewModel />
                                    </Grid.DataContext>
                                    <TextBlock Grid.Row="0" FontSize="20" Foreground="#404040" Margin="10,5">
                                        <Run Text="Annual " /><Run Text="BreakDown" />
                                    </TextBlock>
                                    <Grid Grid.Row="1">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition />
                                            <ColumnDefinition />
                                        </Grid.ColumnDefinitions>
                                        <TextBlock HorizontalAlignment="Center" Margin="0" TextWrapping="Wrap"
                                                   Text="Heating" VerticalAlignment="Top" />
                                        <lvc:PieChart Grid.Column="0" Name="PieHeatingChart"
                                                      Series="{Binding PieHeatingChartGraphSeries}"
                                                      LegendLocation="Bottom" InnerRadius="50" Margin="0 15"
                                                      Height="320" Grid.IsSharedSizeScope="True"
                                                      UseLayoutRounding="False" VerticalContentAlignment="Top">
                                            <lvc:PieChart.DataTooltip>
                                                <lvc:DefaultTooltip BulletSize="20" SelectionMode="OnlySender" />
                                            </lvc:PieChart.DataTooltip>
                                            <lvc:PieChart.ChartLegend>
                                                <lvc:DefaultLegend BulletSize="20" Height="100" />
                                            </lvc:PieChart.ChartLegend>
                                        </lvc:PieChart>
                                        <TextBlock HorizontalAlignment="Center" Margin="0" TextWrapping="Wrap"
                                                   Text="Cooling" VerticalAlignment="Top" Grid.Column="1" />
                                        <lvc:PieChart Name="Chart2"
                                                      Series="{Binding PieCoolingChartGraphSeries}"
                                                      LegendLocation="Bottom" InnerRadius="50" Margin="0 15"
                                                      Height="320" Grid.Column="1" Grid.IsSharedSizeScope="True"
                                                      VerticalContentAlignment="Top">
                                            <lvc:PieChart.DataTooltip>
                                                <lvc:DefaultTooltip BulletSize="20" SelectionMode="OnlySender" />
                                            </lvc:PieChart.DataTooltip>
                                            <lvc:PieChart.ChartLegend>
                                                <lvc:DefaultLegend BulletSize="20" Height="100" />
                                            </lvc:PieChart.ChartLegend>
                                        </lvc:PieChart>

                                    </Grid>

                                </Grid>
                            </Border>
                        </Grid>

                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </TabItem>
    </TabControl>


</UserControl>